"use strict";(self.webpackChunkzosusoft_prj_hirokazu=self.webpackChunkzosusoft_prj_hirokazu||[]).push([[92],{92:(e,n,a)=>{a.r(n),a.d(n,{DynamicConversationScene:()=>o});class o extends Phaser.Scene{constructor(){super(),this.eventId=null,this.resourcesLoaded=!1,this.audioManager=null}init(e){this.eventId=e.eventId,console.log(`[DynamicConversationScene] init called with eventId: ${this.eventId}`)}async preload(){console.log(`[DynamicConversationScene] preload started for event: ${this.eventId}`),this.load.on("complete",(()=>{console.log(`[DynamicConversationScene] リソース読み込み完了: ${this.eventId}`),console.log("[DynamicConversationScene] 読み込まれたリソース:",this.cache.texture?.entries||"texture cache not available")})),this.load.on("error",(e=>{console.error("[DynamicConversationScene] リソース読み込みエラー:",e)})),await this.loadRequiredResources()}async loadRequiredResources(){const{getRequiredResources:e,getEventConfig:n}=await a.e(557).then(a.bind(a,557));this.eventConfig=n(this.eventId);const o=e(this.eventId);o&&(o.backgrounds?.forEach((e=>{this.load.image(e,`assets/backgrounds/miemachi_bk/${e}.png`)})),o.characters?.forEach((e=>{this.load.image(e,`assets/characters/portraits/${e}.png`)})),(o.bgm||o.se)&&(this.audioManager=new((await Promise.resolve().then(a.bind(a,296))).AudioManager)(this))),await this.loadConversationData(),this.conversationDataLoaded=!0,o&&(o.backgrounds||o.characters||o.bgm||o.se)&&await new Promise((e=>{this.load.on("complete",(()=>{this.audioManager&&(o.bgm||o.se)&&(o.bgm&&o.bgm.forEach((e=>{const n=`bgm_${e}`;this.audioManager.loadedSounds.add(n)})),o.se&&o.se.forEach((e=>{const n=`se_${e}`;this.audioManager.loadedSounds.add(n)}))),e()})),this.load.start()})),this.resourcesLoaded=!0}loadConversationData(){return new Promise((e=>{console.log(`[DynamicConversationScene] loadConversationData開始: eventId=${this.eventId}`),console.log("[DynamicConversationScene] eventConfig:",this.eventConfig);const n=this.eventConfig?.areaType;if(console.log(`[DynamicConversationScene] areaType: ${n}`),n)switch(n){case"miemachi":console.log("[DynamicConversationScene] miemachiのconversationDataを読み込み中..."),Promise.resolve().then(a.bind(a,362)).then((({miemachiConversationData:n})=>{const a=this.eventConfig.conversationDataKey;console.log(`[DynamicConversationScene] conversationKey: ${a}`),console.log("[DynamicConversationScene] miemachiConversationData:",n),this.conversationData=n[a],console.log("[DynamicConversationScene] 設定されたconversationData:",this.conversationData),e()}));break;case"taketa":console.log("[DynamicConversationScene] taketaのconversationDataを読み込み中..."),Promise.resolve().then(a.bind(a,327)).then((({taketaConversationData:n})=>{const a=this.eventConfig.conversationDataKey;console.log(`[DynamicConversationScene] conversationKey: ${a}`),this.conversationData=n[a],console.log("[DynamicConversationScene] 設定されたconversationData:",this.conversationData),e()}));break;case"japan":console.log("[DynamicConversationScene] japanのconversationDataを読み込み中..."),Promise.resolve().then(a.bind(a,527)).then((({japanConversationData:n})=>{const a=this.eventConfig.conversationDataKey;console.log(`[DynamicConversationScene] conversationKey: ${a}`),this.conversationData=n[a],console.log("[DynamicConversationScene] 設定されたconversationData:",this.conversationData),e()}));break;default:console.log(`[DynamicConversationScene] 不明なareaType: ${n}`),e()}else console.log("[DynamicConversationScene] areaTypeが設定されていません"),e()}))}create(){if(console.log(`[DynamicConversationScene] create started for event: ${this.eventId}`),!this.resourcesLoaded||!this.conversationDataLoaded)return console.log(`[DynamicConversationScene] リソース読み込み待機中: ${this.eventId}`),void this.time.delayedCall(100,(()=>{this.create()}));console.log(`[DynamicConversationScene] ConversationScene開始: ${this.eventId}`),console.log("[DynamicConversationScene] this.audioManager:",this.audioManager);let e="MiemachiStage";if(this.eventConfig&&this.eventConfig.areaType)switch(this.eventConfig.areaType){case"miemachi":default:e="MiemachiStage";break;case"taketa":e="TaketastageStage";break;case"japan":e="JapanStage"}console.log(`[DynamicConversationScene] 元のシーンキー: ${e}`);const n=this.eventId;console.log(`[DynamicConversationScene] エリア名: ${n}`),this.scene.launch("ConversationScene",{conversationId:this.eventId,eventConfig:this.eventConfig,conversations:this.conversationData,audioManager:this.audioManager,originalSceneKey:e,areaName:n}),this.scene.bringToTop("ConversationScene"),this.scene.stop()}}}}]);