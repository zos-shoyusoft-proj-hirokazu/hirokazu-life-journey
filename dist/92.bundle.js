"use strict";(self.webpackChunkzosusoft_prj_hirokazu=self.webpackChunkzosusoft_prj_hirokazu||[]).push([[92],{92:(e,a,t)=>{t.r(a),t.d(a,{DynamicConversationScene:()=>s});class s extends Phaser.Scene{constructor(){super(),this.eventId=null,this.resourcesLoaded=!1,this.audioManager=null}init(e){this.eventId=e.eventId}async preload(){this.load.on("complete",(()=>{})),this.load.on("error",(e=>{console.error("[DynamicConversationScene] リソース読み込みエラー:",e)})),await this.loadRequiredResources()}async loadRequiredResources(){const{getRequiredResources:e,getEventConfig:a}=await t.e(557).then(t.bind(t,557));this.eventConfig=a(this.eventId);const s=e(this.eventId);s&&(s.backgrounds?.forEach((e=>{this.load.image(e,`assets/backgrounds/miemachi_bk/${e}.png`)})),s.characters?.forEach((e=>{this.load.image(e,`assets/characters/portraits/${e}.png`)})),(s.bgm||s.se)&&(this.audioManager=new((await Promise.resolve().then(t.bind(t,296))).AudioManager)(this))),await this.loadConversationData(),this.conversationDataLoaded=!0,s&&(s.backgrounds||s.characters||s.bgm||s.se)&&await new Promise((e=>{this.load.on("complete",(()=>{this.audioManager&&(s.bgm||s.se)&&(s.bgm&&s.bgm.forEach((e=>{const a=`bgm_${e}`;this.audioManager.loadedSounds.add(a)})),s.se&&s.se.forEach((e=>{const a=`se_${e}`;this.audioManager.loadedSounds.add(a)}))),e()})),this.load.start()})),this.resourcesLoaded=!0}loadConversationData(){return new Promise((e=>{const a=this.eventConfig?.areaType;if(a)switch(a){case"miemachi":Promise.resolve().then(t.bind(t,362)).then((({miemachiConversationData:a})=>{const t=this.eventConfig.conversationDataKey;this.conversationData=a[t],e()}));break;case"taketa":Promise.resolve().then(t.bind(t,327)).then((({taketaConversationData:a})=>{const t=this.eventConfig.conversationDataKey;this.conversationData=a[t],e()}));break;case"japan":Promise.resolve().then(t.bind(t,527)).then((({japanConversationData:a})=>{const t=this.eventConfig.eventConfig.conversationDataKey;this.conversationData=a[t],e()}));break;default:e()}else e()}))}create(){if(!this.resourcesLoaded||!this.conversationDataLoaded)return void this.time.delayedCall(100,(()=>{this.create()}));let e="MiemachiStage";if(this.eventConfig&&this.eventConfig.areaType)switch(this.eventConfig.areaType){case"miemachi":default:e="MiemachiStage";break;case"taketa":e="TaketastageStage";break;case"japan":e="JapanStage"}const a=this.eventConfig?.areaName||this.eventId;this.scene.launch("ConversationScene",{conversationId:this.eventId,eventConfig:this.eventConfig,conversations:this.conversationData,audioManager:this.audioManager,originalSceneKey:e,areaName:a}),this.scene.bringToTop("ConversationScene"),this.scene.stop()}}}}]);