(()=>{"use strict";var e={355:(e,t,a)=>{a.r(t),a.d(t,{startPhaserGame:()=>E});const s=function(){let e,t;document.fullscreenElement?(e=screen.width,t=screen.height):(e=window.innerWidth,window.visualViewport?t=window.visualViewport.height:(t=window.innerHeight,/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=Math.min(window.innerHeight,window.screen.height-100))));let a=e,s=t;return a=Math.max(320,a),s=Math.max(240,s),{width:a,height:s}}(),r={type:Phaser.AUTO,width:s.width,height:s.height,backgroundColor:"#87CEEB",parent:"game-container",scale:{mode:Phaser.Scale.RESIZE,autoCenter:Phaser.Scale.CENTER_BOTH,expandParent:!0,fullscreenTarget:"game-container",resizeCallback:function(){}},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1,fps:60,timeScale:1,skipQuadTree:!1,maxEntries:12,tileBias:16,forceX:!1,overlapBias:4}},render:{antialias:!1,pixelArt:!1,clearBeforeRender:!0,preserveDrawingBuffer:!1,failIfMajorPerformanceCaveat:!1,powerPreference:"default"}};class i{constructor(e){this.scene=e,this.tilemap=null,this.mapLayer=null,this.areas=[],this.mapWidth=0,this.mapHeight=0,this.mapScaleX=1,this.mapScaleY=1,this.scaledMapWidth=0,this.scaledMapHeight=0,this.map=null,this.layers=[],this.npcSprites=new Map,this.objectGroup=null}createMap(e,t,a="タイルレイヤー1"){return arguments.length>0?this.createNewMap(e,t,a):this.createLegacyMap()}createNewMap(e,t,a="タイルレイヤー1"){this.tilemap=this.scene.make.tilemap({key:e}),this.map=this.tilemap;const s=this.tilemap.addTilesetImage(t,t);this.mapLayer=this.tilemap.createLayer(a,s),this.layers=[this.mapLayer],this.mapWidth=this.tilemap.widthInPixels,this.mapHeight=this.tilemap.heightInPixels,this.scaleMapToScreen();const r=this.getObjectLayerName(e);return this.extractAreaData(r),this.tilemap}createLegacyMap(){this.map=this.scene.make.tilemap({key:"map"}),this.tilemap=this.map;try{const e=this.createTilesets();this.createLayers(e),this.placeObjects()}catch(e){console.error("Error creating tilesets/layers:",e),this.createFallbackMap()}return this.map}scaleMapToScreen(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,a=e/this.mapWidth,s=t/this.mapHeight,r=Math.min(a,s);if(this.scene.cameraManager&&(this.scene.cameraManager.currentScale=r,console.log(`MapManager: Set initial scale to ${r} (whole map view)`)),this.mapScaleX=r,this.mapScaleY=r,this.mapLayer){this.mapLayer.setScale(this.mapScaleX,this.mapScaleY);const a=(e-this.mapWidth*this.mapScaleX)/2,s=(t-this.mapHeight*this.mapScaleY)/2;this.mapLayer.setPosition(a,s)}if(this.scaledMapWidth=this.mapWidth*this.mapScaleX,this.scaledMapHeight=this.mapHeight*this.mapScaleY,this.scene.cameraManager){this.scene.cameraManager.camera.setBounds(0,0,e,t),this.scene.cameraManager.camera.setBackgroundColor("#87CEEB");const a=this.mapLayer?this.mapLayer.x:0,s=this.mapLayer?this.mapLayer.y:0;this.scene.cameraManager.camera.centerOn(a+this.scaledMapWidth/2,s+this.scaledMapHeight/2),console.log(`MapManager: Initial camera bounds: (0, 0, ${e}, ${t})`)}this.updateObjectPositions(this.mapScaleX)}getObjectLayerName(e){const t={bunngo_mie_city:"miemachi",taketa_city:"taketa",japan:"zennkoku"};return t[e]||console.warn(`MapManager: Unknown mapKey '${e}', using default layer name`),t[e]}extractAreaData(e=null){if(!e){const t=this.scene.mapConfig?.mapKey||"taketa";e=this.getObjectLayerName(t)}if(!e)return void console.warn(`MapManager: No object layer name found for mapKey '${this.scene.mapConfig?.mapKey}'`);const t=this.tilemap.getObjectLayer(e);t?(this.areas=[],this.areas=t.objects.map((e=>({id:e.id,name:e.name,originalX:e.x,originalY:e.y,originalWidth:e.width,originalHeight:e.height,x:e.x*this.mapScaleX+(this.mapLayer?this.mapLayer.x:0),y:e.y*this.mapScaleY+(this.mapLayer?this.mapLayer.y:0),width:e.width*this.mapScaleX,height:e.height*this.mapScaleY,ellipse:e.ellipse||!1,rotation:e.rotation||0,type:e.type||"location"}))),console.log(`MapManager: Extracted ${this.areas.length} areas from object layer '${e}'`),console.log("MapManager: Areas:",this.areas)):(console.warn(`MapManager: Object layer '${e}' not found`),console.log("MapManager: Available layers:",this.tilemap.layers))}handleResize(){this.scaleMapToScreen();const e=this.getObjectLayerName(this.scene.mapConfig?.mapKey||"taketa");this.extractAreaData(e)}createFallbackImage(e){const t=this.scene.add.graphics();t.fillStyle(65280),t.fillRect(0,0,32,32),t.generateTexture(e,32,32),t.destroy()}getTilemap(){return this.tilemap}getMapLayer(){return this.mapLayer}getAreas(){return this.areas}getMapSize(){return{width:this.mapWidth,height:this.mapHeight,scaledWidth:this.scaledMapWidth,scaledHeight:this.scaledMapHeight}}getMapScale(){return{scaleX:this.mapScaleX,scaleY:this.mapScaleY}}updateObjectPositions(e){if(this.areas&&this.areas.length>0){const t=this.mapLayer?this.mapLayer.x:0,a=this.mapLayer?this.mapLayer.y:0;console.log(`MapManager: Map layer position - x: ${t}, y: ${a}, scale: ${e}`),this.areas.forEach((s=>{s.x=s.originalX*e+t,s.y=s.originalY*e+a,s.width=s.originalWidth*e,s.height=s.originalHeight*e,console.log(`MapManager: Area ${s.name} - original: (${s.originalX}, ${s.originalY}), new: (${s.x}, ${s.y}), size: (${s.width}, ${s.height})`)})),this.scaledMapWidth=this.mapWidth*e,this.scaledMapHeight=this.mapHeight*e,this.scene.areaSelectionManager&&(console.log(`MapManager: Sending ${this.areas.length} areas to AreaSelectionManager`),this.scene.areaSelectionManager.updateAreaPositions([...this.areas])),console.log(`MapManager: Updated object positions with scale ${e}, areas count: ${this.areas.length}`)}else console.warn("MapManager: No areas available for position update")}createTilesets(){const e=[],t={"[A]Grass1_pipo":"[A]Grass1_pipo",backgraund:"pipo-map001_at-kusa",GK_A2_C_autotile:"GK_A2_C_autotile",Preview_RPGMakerVXAce:"Preview_RPGMakerVXAce",Preview:"Preview",GK_JC_A5_2:"GK_JC_A5_2",GK_JC_B_2:"GK_JC_B_2",tiles:"tiles",tileset:"tiles",Tilemap:"Tilemap"},a=[{keyword:"GK_A2_C",texture:"GK_A2_C_autotile"},{keyword:"Preview_RPGMaker",texture:"Preview_RPGMakerVXAce"},{keyword:"GK_JC_A5",texture:"GK_JC_A5_2"},{keyword:"GK_JC_B",texture:"GK_JC_B_2"},{keyword:"Tilemap",texture:"Tilemap"}];return this.map.tilesets.forEach((s=>{let r=null;const i=s.name,n=s.tileWidth||32,o=s.tileHeight||32;let c=t[i];if(!c){const e=a.find((e=>i.includes(e.keyword)));c=e?e.texture:"tiles",e||console.warn(`Unknown tileset: ${i}, using tiles.png as fallback`)}r=this.map.addTilesetImage(i,c,n,o),r&&e.push(r)})),e}createLayers(e){this.map.layers.forEach(((t,a)=>{const s=this.map.createLayer(t.name,e,0,0);if(s){this.layers.push(s);const e=100*a-1e3;s.setDepth(e),s.setCollisionByProperty({collides:!0})}else console.error(`Failed to create layer: ${t.name}`)}))}placeObjects(){this.objectGroup=this.scene.physics.add.staticGroup(),this.map.objects.forEach((e=>{e.objects.forEach((e=>{const t=e.name;if(this.scene.textures.exists(t)){const a=this.scene.add.sprite(e.x,e.y,t,1);if(a.setOrigin(0,0),a.setScale(1),"npc"===e.type)this.npcSprites.set(e.name,a),this.scene.collisionManager.addObjectToCollision(a,{type:"npc",width:e.width||32,height:e.height||32,name:e.name});else{let t=!1;if(e.properties&&Array.isArray(e.properties)){const a=e.properties.find((e=>"collides"===e.name));t=a&&!0===a.value}if(t){let t=e.type||"wall";this.scene.collisionManager.addObjectToCollision(a,{type:t,width:e.width||32,height:e.height||32,name:e.name})}}}else console.warn(`Image not found: ${t} - スプライト作成をスキップします`)}))}))}createFallbackMap(){try{const e=this.map.addTilesetImage("tileset","tiles",32,32),t=this.map.createLayer(0,e,0,0);t&&(this.layers.push(t),t.setDepth(-1),t.setCollisionByProperty({collides:!0}))}catch(e){console.error("Fallback also failed:",e)}}getObjectGroup(){return this.objectGroup}getNpcSprite(e){return this.npcSprites.get(e)}makeNpcFacePlayer(e,t,a){const s=this.getNpcSprite(e);if(!s)return void console.warn(`NPC sprite not found: ${e}`);const r=t-s.x,i=a-s.y;let n,o;switch(n=Math.abs(r)>Math.abs(i)?r>0?"right":"left":i>0?"down":"up",n){case"down":default:o=1;break;case"left":o=4;break;case"right":o=7;break;case"up":o=10}s.setFrame(o)}destroy(){this.layers&&this.layers.length>0&&(this.layers.forEach((e=>{e&&e.destroy&&e.destroy()})),this.layers=[]),this.mapLayer&&this.mapLayer.destroy&&(this.mapLayer.destroy(),this.mapLayer=null),this.tilemap&&this.tilemap.destroy&&(this.tilemap.destroy(),this.tilemap=null),this.map&&this.map.destroy&&(this.map.destroy(),this.map=null),this.npcSprites&&(this.npcSprites.forEach((e=>{e&&e.destroy&&e.destroy()})),this.npcSprites.clear()),this.objectGroup&&this.objectGroup.destroy&&(this.objectGroup.destroy(),this.objectGroup=null),this.areas=[],this.mapWidth=0,this.mapHeight=0,this.mapScaleX=1,this.mapScaleY=1,this.scaledMapWidth=0,this.scaledMapHeight=0}}class n{constructor(e){this.scene=e,this.player=null,this.cursors=null,this.wasd=null,this.speed=300}createPlayer(e,t){this.scene.textures.exists("player_placeholder")||this.scene.textures.addBase64("player_placeholder","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="),this.player=this.scene.physics.add.sprite(e,t,"player_placeholder"),this.player.setDisplaySize(30,30),this.player.setTint(16711680),this.player.setCollideWorldBounds(!0),this.player.setBounce(0),this.player.setDrag(200)}setInputKeys(e,t){this.cursors=e,this.wasd=t}update(){if(!this.player||!this.cursors||!this.wasd)return;let e=0,t=0;this.cursors.left.isDown||this.wasd.A.isDown?e=-this.speed:(this.cursors.right.isDown||this.wasd.D.isDown)&&(e=this.speed),this.cursors.up.isDown||this.wasd.W.isDown?t=-this.speed:(this.cursors.down.isDown||this.wasd.S.isDown)&&(t=this.speed),this.player.setVelocityX(e),this.player.setVelocityY(t)}setVelocity(e,t){this.player&&(this.player.setVelocityX(e),this.player.setVelocityY(t))}getPosition(){return this.player?{x:this.player.x,y:this.player.y}:{x:0,y:0}}destroy(){try{this.player&&(this.player.destroy(),this.player=null),this.cursors=null,this.wasd=null}catch(e){console.error("Error during PlayerController cleanup:",e)}}}class o{constructor(e){this.scene=e,this.activeEffects=[]}showTouchRipple(e,t,a=65280,s=400){const r=this.scene.add.circle(e,t,10,a,.7);r.setDepth(9999),this.scene.tweens.add({targets:r,scaleX:5,scaleY:5,alpha:0,duration:s,ease:"Power2",onComplete:()=>{r.destroy()}}),this.activeEffects.push(r)}showObjectRipple(e,t,a,s,r=16711680,i=400){const n=Math.max(a,s)/2,o=this.scene.add.circle(e,t,n,r,.7);o.setDepth(9999),this.scene.tweens.add({targets:o,scaleX:3,scaleY:3,alpha:0,duration:i,ease:"Power2",onComplete:()=>{o.destroy()}}),this.activeEffects.push(o)}showButtonHover(e,t=1.2,a=16766720,s=.7){e.setScale&&e.setScale(t),e.setFillStyle&&e.setFillStyle(a,s)}resetButtonState(e,t=1,a=4286945,s=.7){e.setScale&&e.setScale(t),e.setFillStyle&&e.setFillStyle(a,s)}showSelectionEffect(e,t,a=16776960,s=16711680){const r=this.scene.add.circle(e,t,30,a,.6);r.setStrokeStyle(4,s),this.scene.tweens.add({targets:r,scaleX:2,scaleY:2,alpha:0,duration:800,ease:"Power2",onComplete:()=>{r.destroy()}}),this.activeEffects.push(r)}destroy(){this.activeEffects&&this.activeEffects.length>0&&(this.activeEffects.forEach((e=>{e&&e.destroy&&e.destroy()})),this.activeEffects=[]),this.scene=null}}class c{constructor(e,t,a="se_touch"){this.scene=e,this.player=t,this.seKey=a,this.visualFeedback=new o(e),this.touchStartX=0,this.touchStartY=0,this.isPointerDown=!1,this.targetX=0,this.targetY=0,this.setupVirtualGamepad(),this.scene.input.on("pointerdown",(e=>{this.showTouchFeedback(e.x,e.y)}))}setupVirtualGamepad(){const e=this.scene.scale.width-120,t=this.scene.scale.height-120;this.baseCircle=this.scene.add.circle(e,t,50,3355443,.6),this.baseCircle.setScrollFactor(0),this.baseCircle.setStrokeStyle(2,5592405),this.baseCircle.setDepth(1e3),this.stickCircle=this.scene.add.circle(e,t,20,8947848,.9),this.stickCircle.setScrollFactor(0),this.stickCircle.setStrokeStyle(2,11184810),this.stickCircle.setDepth(1001),this.centerX=e,this.centerY=t,this.maxDistance=40,this.currentInput={x:0,y:0},this.isStickActive=!1,this.currentPointerId=null;const a=this.scene.add.circle(e,t,80,0,.01);a.setScrollFactor(0),a.setDepth(999),a.setInteractive(),a.on("pointerdown",(e=>{null===this.currentPointerId&&this.startStickControl(e)})),this.scene.input.on("pointermove",(e=>{this.isStickActive&&e.id===this.currentPointerId&&this.updateStick(e.x,e.y)})),this.scene.input.on("pointerup",(e=>{this.isStickActive&&e.id===this.currentPointerId&&this.endStickControl()})),this.scene.scale.on("resize",this.handleResize,this)}startStickControl(e){this.isStickActive=!0,this.currentPointerId=e.id,this.stickCircle.setAlpha(1),this.baseCircle.setAlpha(.8),this.updateStick(e.x,e.y)}endStickControl(){this.isStickActive=!1,this.currentPointerId=null,this.resetStick(),this.stickCircle.setAlpha(.9),this.baseCircle.setAlpha(.6)}handleResize(){const e=this.scene.scale.width,t=this.scene.scale.height;this.centerX=e-120,this.centerY=t-120,this.baseCircle.setPosition(this.centerX,this.centerY),this.stickCircle.setPosition(this.centerX,this.centerY)}updateStick(e,t){const a=e-this.centerX,s=t-this.centerY;let r=e,i=t;if(Math.sqrt(a*a+s*s)>this.maxDistance){const e=Math.atan2(s,a);r=this.centerX+Math.cos(e)*this.maxDistance,i=this.centerY+Math.sin(e)*this.maxDistance}this.stickCircle.x=r,this.stickCircle.y=i;const n=(r-this.centerX)/this.maxDistance,o=(i-this.centerY)/this.maxDistance;if(this.currentInput.x=n,this.currentInput.y=o,Math.sqrt(n*n+o*o)<.05)return void(this.player&&this.player.setVelocityX&&(this.player.setVelocityX(0),this.player.setVelocityY(0)));const c=450*n,h=450*o;this.player&&this.player.setVelocityX&&(this.player.setVelocityX(c),this.player.setVelocityY(h))}resetStick(){this.stickCircle.x=this.centerX,this.stickCircle.y=this.centerY,this.currentInput.x=0,this.currentInput.y=0,this.player&&this.player.setVelocityX&&(this.player.setVelocityX(0),this.player.setVelocityY(0))}getCurrentInput(){return{...this.currentInput}}enableAreaSelection(e){this.areaSelectionManager=e,this.hideVirtualGamepad(),this.setupAreaSelectionTouch()}hideVirtualGamepad(){this.baseCircle&&this.baseCircle.setVisible(!1),this.stickCircle&&this.stickCircle.setVisible(!1)}showVirtualGamepad(){this.baseCircle&&this.baseCircle.setVisible(!0),this.stickCircle&&this.stickCircle.setVisible(!0)}setupAreaSelectionTouch(){this.scene.input.on("pointerdown",(e=>{this.handleAreaSelectionTouch(e)})),this.touchStartTime=0,this.longPressThreshold=500}handleAreaSelectionTouch(e){try{if(this.touchStartTime=Date.now(),!this.scene.cameras||!this.scene.cameras.main)return void console.error("TouchControlManager: Camera not available");const t=this.scene.cameras.main.getWorldPoint(e.x,e.y),a=t.x,s=t.y;this.areaSelectionManager&&this.areaSelectionManager.handleTouchAt(a,s),this.showTouchFeedback(a,s)}catch(e){console.error("TouchControlManager: Error in handleAreaSelectionTouch:",e)}}showTouchFeedback(e,t){this.visualFeedback.showTouchRipple(e,t),this.scene.audioManager&&this.scene.audioManager.playSe&&this.scene.audioManager.playSe(this.seKey,.3)}disableAreaSelection(){this.areaSelectionManager=null,this.showVirtualGamepad(),this.scene.input.off("pointerdown")}destroy(){this.baseCircle&&this.baseCircle.destroy(),this.stickCircle&&this.stickCircle.destroy(),this.scene.scale.off("resize",this.handleResize,this)}}class h{constructor(){this.playerPosText=null,this.backButton=null}createUI(e){e.add.text(400,50,"★★★テスト中★★★bbbbb",{fontSize:"24px",fill:"#000000",fontWeight:"bold"}).setOrigin(.5),e.add.text(400,550,"矢印キーまたはWASDで移動！マップ上を歩いてみよう！",{fontSize:"16px",fill:"#000000"}).setOrigin(.5),this.playerPosText=e.add.text(10,10,"",{fontSize:"16px",fill:"#000000",backgroundColor:"#ffffff",padding:{x:5,y:5}}),this.createBackButton(e)}createBackButton(e){if(!e||!e.cameras||!e.cameras.main)return void console.warn("UIManager: Scene or camera is not available for back button");if(!e.input)return void console.warn("UIManager: Scene input system is not available for back button");this.backButtonGraphics=e.add.graphics(),this.backButtonGraphics.fillStyle(0,.3),this.backButtonGraphics.fillRoundedRect(4.5,4.5,155,30,8),this.backButtonGraphics.fillStyle(2763306,.95),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,30,8),this.backButtonGraphics.fillStyle(16777215,.1),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,15,8),this.backButtonGraphics.setDepth(1e3),this.backButtonGraphics.setScrollFactor(0),this.backButtonGraphics.setInteractive(new Phaser.Geom.Rectangle(5,5,150,40),Phaser.Geom.Rectangle.Contains);let t="戻る";e.scene&&e.scene.key&&("Stage1Scene"===e.scene.key||"Stage2Scene"===e.scene.key||"Stage3Scene"===e.scene.key?t="マップに戻る":"MiemachiStage"!==e.scene.key&&"TaketastageStage"!==e.scene.key&&"JapanStage"!==e.scene.key||(t="ステージ選択画面")),this.backButtonGraphics.on("pointerdown",(()=>{if("Stage1Scene"===e.scene?.key||"Stage2Scene"===e.scene?.key||"Stage3Scene"===e.scene?.key)if(window.returnToMap)window.returnToMap();else if(window.returnToStageSelect)window.returnToStageSelect();else if(window.returnToMiemachi)window.returnToMiemachi();else{const e=document.getElementById("stage-select"),t=document.getElementById("game-container");e&&(e.style.display="flex"),t&&(t.style.display="none")}else if("MiemachiStage"===e.scene?.key||"TaketastageStage"===e.scene?.key||"JapanStage"===e.scene?.key)if(window.returnToMap=null,window.returnToStageSelect)try{window.returnToStageSelect()}catch(e){}else{const e=document.getElementById("stage-select"),t=document.getElementById("game-container");e&&(e.style.display="flex"),t&&(t.style.display="none")}else if(window.returnToStageSelect)window.returnToStageSelect();else{const e=document.getElementById("stage-select"),t=document.getElementById("game-container");e&&(e.style.display="flex"),t&&(t.style.display="none")}})),e.input&&e.input.keyboard&&e.input.keyboard.on("keydown-ESC",(()=>{if(window.returnToStageSelect)window.returnToStageSelect();else{const e=document.getElementById("stage-select"),t=document.getElementById("game-container");e&&(e.style.display="block"),t&&(t.style.display="none")}})),this.backButtonGraphics.on("pointerover",(()=>{this.backButtonGraphics.clear(),this.backButtonGraphics.fillStyle(0,.4),this.backButtonGraphics.fillRoundedRect(4.5,4.5,155,30,8),this.backButtonGraphics.fillStyle(3815994,.98),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,30,8),this.backButtonGraphics.fillStyle(16777215,.15),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,15,8)})),this.backButtonGraphics.on("pointerout",(()=>{this.backButtonGraphics.clear(),this.backButtonGraphics.fillStyle(0,.3),this.backButtonGraphics.fillRoundedRect(4.5,4.5,155,30,8),this.backButtonGraphics.fillStyle(2763306,.95),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,30,8),this.backButtonGraphics.fillStyle(16777215,.1),this.backButtonGraphics.fillRoundedRect(2.5,2.5,155,15,8)})),this.backButtonText=e.add.text(80,25,t,{fontSize:"18px",fill:"#ffffff",fontWeight:"bold",fixedHeight:50,wordWrap:{width:150},align:"center",padding:{x:10,y:10}}),this.backButtonText.setOrigin(.5,.5),this.backButtonText.setScrollFactor(0),this.backButtonText.setDepth(1001),e.scale.on("resize",(()=>{e&&e.cameras&&e.cameras.main&&this.backButtonGraphics}))}updatePlayerPosition(e){(!this.lastPlayerX||!this.lastPlayerY||Math.abs(e.x-this.lastPlayerX)>1||Math.abs(e.y-this.lastPlayerY)>1)&&(this.lastPlayerX=e.x,this.lastPlayerY=e.y),this.playerPosText&&this.playerPosText.setText(`ひろかず位置: X=${Math.round(e.x)}, Y=${Math.round(e.y)}`)}createMapUI(e,t){this.titleText=e.add.text(5,e.cameras.main.height-25,t,{fontSize:"18px",fill:"#FFD700",fontWeight:"bold",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:{x:12,y:6},borderRadius:8,stroke:"#FF6B35",strokeThickness:2,shadow:{offsetX:3,offsetY:3,color:"#000000",blur:6,fill:!0}}).setOrigin(0,1),this.instructionText=e.add.text(5,e.cameras.main.height,"場所をタップして移動！",{fontSize:"14px",fill:"#FF6B35",backgroundColor:"rgba(0, 0, 0, 0.3)",padding:{x:8,y:4},borderRadius:6,stroke:"#FF00FF",strokeThickness:2,shadow:{offsetX:3,offsetY:3,color:"#FF6B35",blur:8,fill:!0}}).setOrigin(0,1),this.selectedAreaText=e.add.text(e.cameras.main.centerX,e.cameras.main.height-50,"",{fontSize:"14px",fill:"#000000",backgroundColor:"transparent",padding:{x:8,y:4},borderRadius:8}).setOrigin(.5)}updateMapUI(e){const t=e.width/2;this.titleText&&this.titleText.setPosition(10,e.height-40),this.instructionText&&this.instructionText.setPosition(10,e.height-15),this.selectedAreaText&&this.selectedAreaText.setPosition(t,e.height-50)}showSelectedArea(e,t){this.selectedAreaText&&this.selectedAreaText.setText(`エリア: ${e}\n${t}`)}destroy(){if(!this._destroyed){this._destroyed=!0;try{const e=e=>{this[e]&&"function"==typeof this[e].destroy&&(this[e].destroy(),this[e]=null)};e("playerPosText"),e("backButtonGraphics"),e("backButtonText"),e("titleText"),e("instructionText"),e("selectedAreaText")}catch(e){console.error("Error during UIManager cleanup:",e)}}}}class p{constructor(e){this.scene=e,this.camera=e.cameras.main,this.zoom=1,this.followTarget=null,this.bounds=null,this.currentScale=null}setupCamera(e,t,a){if(1===arguments.length&&"object"==typeof e&&e.width){const t=e;this.camera.setZoom(this.zoom);const a=this.scene.mapManager?.mapLayer,s=a?a.x:0,r=a?a.y:0,i=this.scene.cameras.main.width,n=this.scene.cameras.main.height;this.camera.setBounds(0,0,i,n),this.camera.centerOn(s+t.scaledWidth/2,r+t.scaledHeight/2)}else if(3===arguments.length){const s=e,r=t.widthInPixels,i=t.heightInPixels;s.cameras.main.setBounds(0,0,r,i),s.cameras.main.startFollow(a),s.physics.world.setBounds(0,0,r,i)}}setZoom(e){this.zoom=e,this.camera.setZoom(e)}centerOn(e,t){this.camera.centerOn(e,t)}setFollowTarget(e,t=.1){this.followTarget=e,this.camera.startFollow(e,!0,t,t)}stopFollow(){this.followTarget=null,this.camera.stopFollow()}setBackgroundColor(e){this.camera.setBackgroundColor(e)}fadeIn(e=1e3,t){this.camera.fadeIn(e,0,0,0,t)}fadeOut(e=1e3,t){this.camera.fadeOut(e,0,0,0,t)}shake(e=100,t=.02){this.camera.shake(e,t)}flash(e=100,t=16777215){this.camera.flash(e,t)}getBounds(){return this.bounds}getZoom(){return this.zoom}getWorldPoint(e,t){return this.camera.getWorldPoint(e,t)}getScreenPoint(e,t){return this.camera.getScreenPoint(e,t)}update(){}setupScrollControls(){let e=!1,t={x:0,y:0},a={x:0,y:0};this.scene.input.on("pointerdown",(s=>{e=!0,t={x:s.x,y:s.y},a={x:this.camera.scrollX,y:this.camera.scrollY}})),this.scene.input.on("pointermove",(s=>{if(e){const e=t.x-s.x,r=t.y-s.y,i=a.x+e,n=a.y+r;this.camera.setScroll(i,n)}})),this.scene.input.on("pointerup",(()=>{e=!1}))}setupPinchZoom(){let e=0,t=1;this.scene.input.on("pointerdown",(()=>{if(this.scene.input.pointers&&2===this.scene.input.pointers.length){const a=this.scene.input.pointers[0],s=this.scene.input.pointers[1];e=Phaser.Math.Distance.Between(a.x,a.y,s.x,s.y),t=this.camera.zoom}})),this.scene.input.on("pointermove",(()=>{if(this.scene.input.pointers&&2===this.scene.input.pointers.length){const a=this.scene.input.pointers[0],s=this.scene.input.pointers[1],r=Phaser.Math.Distance.Between(a.x,a.y,s.x,s.y)/e,i=Math.max(.5,Math.min(3,t*r));this.camera.setZoom(i)}}))}toggleMapScale(){if(1.5===(this.scene.mapManager?.mapScaleX||this.currentScale)){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,a=e/this.scene.mapManager.mapWidth,s=t/this.scene.mapManager.mapHeight,r=Math.min(a,s);this.setMapScale(r)}else this.setMapScale(1.5)}setMapScale(e){if(this.currentScale=e,!this.scene.mapManager||!this.scene.mapManager.mapLayer)return;this.scene.mapManager.mapLayer.setScale(e,e),this.scene.mapManager.mapScaleX=e,this.scene.mapManager.mapScaleY=e;const t=this.scene.cameras.main.width,a=this.scene.cameras.main.height,s=this.scene.mapManager.mapWidth*e,r=this.scene.mapManager.mapHeight*e,i=(t-s)/2,n=(a-r)/2;if(this.scene.mapManager.mapLayer.setPosition(i,n),this.scene.mapManager.updateObjectPositions(e),this.scene.areaSelectionManager){const e=this.scene.mapManager.getAreas(),t=this.scene.mapConfig.areas,a=e.map((e=>{const a=t.find((t=>t.name===e.name));return{...e,scene:a?.scene||null}}));this.scene.areaSelectionManager.setupAreas(a)}1.5===e?this.camera.setBounds(i,n,s,r):(this.camera.setBackgroundColor("#87CEEB"),this.camera.setBounds(0,0,t,a)),this.camera.centerOn(i+s/2,n+r/2),console.log(`CameraManager: Scale changed to ${e}, map position: (${i}, ${n}), size: (${s}, ${r})`)}destroy(){this.stopFollow(),this.followTarget=null,this.bounds=null}}class l{constructor(){this.cursors=null,this.wasd=null}setupKeyboard(e,t){this.cursors=e.input.keyboard.createCursorKeys(),this.wasd=e.input.keyboard.addKeys("W,S,A,D"),t.setInputKeys(this.cursors,this.wasd)}destroy(){try{this.cursors&&(this.cursors=null),this.wasd&&(this.wasd=null)}catch(e){console.error("Error during InputManager cleanup:",e)}}}class u{constructor(e){this.scene=e,this.dialogSystem=null,this.collisionGroups={walls:null,npcs:null,items:null,enemies:null}}setDialogSystem(e){this.dialogSystem=e}setupCollisionGroups(){this.collisionGroups.walls=this.scene.physics.add.staticGroup(),this.collisionGroups.npcs=this.scene.physics.add.staticGroup(),this.collisionGroups.items=this.scene.physics.add.group(),this.collisionGroups.enemies=this.scene.physics.add.group()}addObjectToCollision(e,t){const a=t.type||"wall";this.scene.physics.add.existing(e,"item"!==a&&"enemy"!==a);const s=t.width||32,r=t.height||32;switch(e.body.setSize(s,r),a){case"npc":this.collisionGroups.npcs.add(e),e.setInteractive(),e.on("pointerdown",(()=>{this.startConversation(t.name)}));break;case"item":this.collisionGroups.items.add(e),e.setData("itemId",t.name);break;case"enemy":this.collisionGroups.enemies.add(e),e.setData("enemyId",t.name);break;default:this.collisionGroups.walls.add(e)}}setupPlayerCollisions(e){this.scene.physics.add.collider(e,this.collisionGroups.walls),this.scene.physics.add.collider(e,this.collisionGroups.npcs),this.scene.physics.add.overlap(e,this.collisionGroups.items,this.collectItem,null,this.scene),this.scene.physics.add.overlap(e,this.collisionGroups.enemies,this.encounterEnemy,null,this.scene)}collectItem(e,t){t.destroy()}startConversation(e){if(this.scene.playerController&&this.scene.playerController.player&&this.scene.mapManager){const t=this.scene.playerController.getPosition();this.scene.mapManager.makeNpcFacePlayer(e,t.x,t.y)}this.scene.conversationTrigger?this.scene.conversationTrigger.startConversation(e):this.dialogSystem&&this.dialogSystem.startDialog(e)}isDialogActive(){return!!this.dialogSystem&&this.dialogSystem.isDialogActive()}getDialogSystem(){return this.dialogSystem}setupAllCollisions(e,t){this.setupTileCollisions(e,t),this.setupPlayerCollisions(e)}setupTileCollisions(e,t){t&&t.layers&&t.layers.forEach((t=>{t&&this.scene.physics.add.collider(e,t)}))}destroy(){this.collisionGroups&&(Object.keys(this.collisionGroups).forEach((e=>{this.collisionGroups[e]&&(this.collisionGroups[e].clear(),this.collisionGroups[e]=null)})),this.collisionGroups=null),this.dialogSystem=null,this.scene=null}}class g{constructor(e){this.scene=e}setupObjectBehavior(e,t){switch(t.type){case"npc":this.setupNpcBehavior(e,t);break;case"item":this.setupItemBehavior(e);break;case"enemy":this.setupEnemyBehavior(e,t)}}setupNpcBehavior(e,t){switch(t.name){case"kuccoro1":this.setupKuccoro1Animation(e);break;case"kuccoro2":this.setupKuccoro2Animation(e);break;case"kuccoro3":this.setupKuccoro3Animation(e);break;case"hanni":this.setupHanniAnimation(e)}}setupItemBehavior(e){this.scene.tweens.add({targets:e,alpha:.7,duration:1e3,yoyo:!0,repeat:-1})}setupEnemyBehavior(e,t){switch(t.name){case"enemy1":this.setupEnemy1Animation(e);break;case"enemy2":this.setupEnemy2Animation(e);break;default:this.setupDefaultEnemyAnimation(e)}}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}setupKuccoro1Animation(e){e.hasAnimation||(e.hasAnimation=!0,this.isMobile()?this.scene.tweens.add({targets:e,y:e.y+3,duration:3e3,yoyo:!0,repeat:-1,ease:"Linear"}):this.scene.tweens.add({targets:e,y:e.y+5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}))}setupKuccoro2Animation(e){this.isMobile()||this.scene.tweens.add({targets:e,x:e.x+20,duration:2e3,yoyo:!0,repeat:-1,ease:"Power1"})}setupKuccoro3Animation(e){this.isMobile()||this.scene.tweens.add({targets:e,rotation:2*Math.PI,duration:4e3,repeat:-1,ease:"Linear"})}setupHanniAnimation(e){this.scene.tweens.add({targets:e,scale:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setupEnemy1Animation(e){this.scene.tweens.add({targets:e,x:e.x+50,duration:2e3,yoyo:!0,repeat:-1,ease:"Power2"})}setupEnemy2Animation(e){this.scene.tweens.add({targets:e,y:e.y+30,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setupDefaultEnemyAnimation(e){this.scene.tweens.add({targets:e,x:e.x+25,duration:3e3,yoyo:!0,repeat:-1,ease:"Linear"})}startConversation(e){this.scene.conversationTrigger?this.scene.conversationTrigger.startConversation(e):this.scene.collisionManager&&this.scene.collisionManager.startConversation(e)}destroy(){this.scene=null}}class d{constructor(e,t){e&&e.scene?(this.scene=e,this.isActive=!1,this.dialogContainer=null,this.dialogText=null,this.currentDialog=null,this.currentTextIndex=0,this.dialogs=t,this.setupUI(),this.setupInput()):console.error("DialogSystem: Invalid scene provided")}setupUI(){if(!this.scene||!this.scene.cameras||!this.scene.cameras.main)return void console.warn("DialogSystem: Scene or camera is not available");this.dialogContainer&&this.dialogContainer.destroy();const e=this.scene.cameras.main,t=e.width||800,a=e.height||600,s=a-120-20-20;this.dialogContainer=this.scene.add.container(0,0),this.dialogContainer.setDepth(1e4),this.dialogContainer.setVisible(!1);const r=this.scene.add.rectangle(t/2,s+60,t-20,120,0,.8);this.dialogText=this.scene.add.text(30,s+60,"",{fontSize:"18px",fill:"#ffffff",metrics:{ascent:15,descent:5,fontSize:18},wordWrap:{width:t-60}}),this.dialogText.setOrigin(0,.5),this.continueIndicator=this.scene.add.text(t-20,s+60-20,"タップで続行",{fontSize:"12px",fill:"#ffff00",align:"center"}),this.continueIndicator.setOrigin(1,1),this.scene.tweens.add({targets:this.continueIndicator,alpha:.3,duration:800,yoyo:!0,repeat:-1}),this.dialogContainer.add([r,this.dialogText,this.continueIndicator]),r.removeAllListeners(),r.setInteractive({hitArea:new Phaser.Geom.Rectangle(-t/2,-80,t,160),hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!1}),r.on("pointerdown",((e,t,a,s)=>{s&&s.stopPropagation&&s.stopPropagation(),this.isActive&&this.nextDialog()})),this.dialogContainer.setInteractive({hitArea:new Phaser.Geom.Rectangle(0,0,t,a),hitAreaCallback:Phaser.Geom.Rectangle.Contains}),this.dialogContainer.on("pointerdown",((e,t,a,s)=>{s&&s.stopPropagation&&s.stopPropagation(),this.isActive&&this.nextDialog()})),this.dialogContainer.setScrollFactor(0),this.scene.scale.off("resize",this.handleResize,this),this.scene.scale.on("resize",this.handleResize,this)}handleResize(e){this.scene&&this.scene.cameras&&this.scene.cameras.main&&this.dialogContainer?this.setupUI():console.warn("DialogSystem: Scene, camera, or dialog container is not available for resize")}setupInput(){this.scene&&this.scene.input&&this.scene.input.keyboard?this.scene.input.keyboard.on("keydown-SPACE",(()=>{this.isActive&&this.nextDialog()})):console.warn("DialogSystem: Scene input is not available")}startDialog(e){this.dialogs[e]?(this.currentDialog=this.dialogs[e],this.currentTextIndex=0,this.isActive=!0,this.currentTextIndex=0,this.dialogContainer.setVisible(!0),this.showMessage()):console.error("No dialog found for:",e)}showMessage(){if(!this.currentDialog||!this.currentDialog.messages)return;if(this.currentTextIndex>=this.currentDialog.messages.length)return void this.endDialog();const e=this.currentDialog.messages[this.currentTextIndex];console.log("[DialogSystem] showMessage",{index:this.currentTextIndex,name:this.currentDialog.name,text:e}),this.dialogText.setText(e)}nextDialog(){this.currentTextIndex++,this.showMessage()}endDialog(){this.isActive=!1,this.dialogContainer&&this.dialogContainer.setVisible(!1),this.scene&&this.scene.scale&&this.scene.scale.off("resize",this.handleResize,this)}isDialogActive(){return this.isActive}destroy(){this.endDialog(),this.dialogContainer&&(this.dialogContainer.destroy(),this.dialogContainer=null),this.dialogText&&(this.dialogText.destroy(),this.dialogText=null),this.scene&&this.scene.scale&&this.scene.scale.off("resize",this.handleResize,this),this.scene&&this.scene.input&&this.scene.input.keyboard&&this.scene.input.keyboard.off("keydown-SPACE"),this.currentDialog=null,this.currentTextIndex=0,this.dialogs=null,this.scene=null}}const x={kuccoro1:{name:"くっころ1",messages:["クンニちわ！","今日はいい天気ですね","また会いましょう！"]},kuccoro2:{name:"くっころ2",messages:["くっ、、、殺せ！","イクイクイクイクイクっ、おっちんぽーーーーー！"]},kuccoro3:{name:"エッチな女騎士",messages:["くっ、、、ころせ！","イグイグイグぅぅ！"]},enemy1:{name:"敵1",messages:["グルル...","通さないぞ！"]},enemy2:{name:"敵2",messages:["ここから先は危険だ","引き返すんだ！"]}},k={demo_chinpo:{background:"test_1",bgm:"bgm_demo_chinpo",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"おれけっこんすんだ",expression:"A"},{speaker:"だいち",character:"daichi",text:"お前もか",expression:"A"},{speaker:"河村",character:"hirokazu",text:"そんなに固くならなくてもいい",expression:"B"},{speaker:"なおき",character:"naoki",text:"ちんぽかためます",expression:"A"},{speaker:"だいち",character:"daichi",text:"やったね！",expression:"A"},{speaker:"なおき",character:"naoki",text:"俺の特殊能力、メタルチンコはがねのように硬いぜ★",expression:"A"},{speaker:"なおき",character:"naoki",text:"金玉もでかいぜ！",expression:"A"}]},after_chinpo:{background:"test_1",bgm:"bgm_demo_chinpo",conversations:[{speaker:"河室",character:"hirokazu",text:"（新しいクラスか...少し緊張するな）",expression:"E"},{speaker:"河室",character:"hirokazu",text:"あ、あなたが転校生の方ですね！",expression:"F"},{speaker:"河室",character:"hirokazu",text:"はい、今日からお世話になります",expression:"D"},{speaker:"河室",character:"hirokazu",text:"私、田中花子です。よろしくお願いします！",expression:"C"},{speaker:"河室",character:"hirokazu",text:"こちらこそ。分からないことがあったら教えてください",expression:"A"},{speaker:"河室",character:"hirokazu",text:"はい！何でも聞いてくださいね♪",expression:"E"}]}};class m{constructor(){this.conversations=k,this.currentEvent=null}getConversation(e){return this.conversations[e]||null}getAvailableEvents(){return Object.keys(this.conversations)}addConversation(e,t){this.conversations[e]=t}updateConversation(e,t){return!!this.conversations[e]&&(this.conversations[e]=t,!0)}}class y{constructor(e){this.scene=e,this.conversationManager=new m,this.isConversationActive=!1,this.triggeredEvents=new Set}startConversation(e){const t=this.conversationManager.getConversation(e);t?this.startVisualNovelConversation(t):this.startSimpleDialog(e)}startVisualNovelConversation(e){if(!this.scene||!this.scene.scene)return void console.warn("[ConversationTrigger] Scene is not available for conversation");this.isConversationActive&&(this.scene.scene.stop("ConversationScene"),this.isConversationActive=!1);const t=this.scene.scene.get("ConversationScene");t&&t.scene.isActive()&&this.scene.scene.stop("ConversationScene"),this.isConversationActive=!0;try{this.scene.time.delayedCall(100,(()=>{if(!this.scene||!this.scene.scene)return console.warn("[ConversationTrigger] Scene became invalid during conversation start"),void(this.isConversationActive=!1);this.scene.scene.launch("ConversationScene");const t=this.scene.scene.get("ConversationScene");t?(this.scene.time.delayedCall(200,(()=>{try{if(!this.scene||!this.scene.scene)return console.warn("[ConversationTrigger] Scene became invalid during conversation setup"),void(this.isConversationActive=!1);t.startConversation(e)}catch(e){console.error("[ConversationTrigger] 会話開始エラー:",e),console.error("[ConversationTrigger] エラースタック:",e.stack),this.isConversationActive=!1}})),t.events.once("conversationEnded",(()=>{this.scene.scene.stop("ConversationScene"),this.isConversationActive=!1}))):(console.error("[ConversationTrigger] ConversationSceneの取得に失敗"),this.isConversationActive=!1)}))}catch(e){console.error("[ConversationTrigger] startVisualNovelConversation()でエラーが発生:",e),console.error("[ConversationTrigger] エラースタック:",e.stack),this.isConversationActive=!1}}startSimpleDialog(e){this.scene.collisionManager&&this.scene.collisionManager.getDialogSystem()&&this.scene.collisionManager.getDialogSystem().startDialog(e)}setupNpcClickHandler(e,t){e.setInteractive(),e.on("pointerdown",(()=>{this.isConversationActive||this.startConversation(t)}))}setupAreaTrigger(e,t,a,s,r){const i=this.scene.add.rectangle(e,t,a,s,0,0);return i.setInteractive(),this.scene.physics.add.existing(i),i.body.setSize(a,s),this.scene.physics.add.overlap(this.scene.playerController.player,i,(()=>{this.isConversationActive||this.triggeredEvents.has(r)||(this.triggeredEvents.add(r),this.startConversation(r))}),null,this.scene),i}setupProximityTrigger(e,t,a,s){const r=this.scene.add.circle(e,t,a,0,0);return this.scene.physics.add.existing(r),r.body.setCircle(a),this.scene.physics.add.overlap(this.scene.playerController.player,r,(()=>{this.isConversationActive||this.triggeredEvents.has(s)||(this.triggeredEvents.add(s),this.startConversation(s))}),null,this.scene),r}isActive(){return this.isConversationActive}destroy(){this.isConversationActive&&(this.scene.scene.stop("ConversationScene"),this.isConversationActive=!1),this.triggeredEvents.clear(),this.scene=null,this.conversationManager&&(this.conversationManager=null)}}class A extends Phaser.Scene{constructor(){super({key:"ConversationScene"}),this.currentConversationIndex=0,this.currentConversation=null,this.isTextAnimating=!1,this.textSpeed=30,this.originalBgm=null,this.eventBgm=null}create(){if(!this.sys)return void console.error("[ConversationScene] this.sys が undefined です");if(!this.sys.game)return void console.error("[ConversationScene] this.sys.game が undefined です");this.cleanupCharacterSprites(),this.currentTextTimer&&(this.currentTextTimer.destroy(),this.currentTextTimer=null);const e=this.sys?.game?.canvas?.width||this.sys?.game?.config?.width||800,t=this.sys?.game?.canvas?.height||this.sys?.game?.config?.height||600;if(this.background=this.add.rectangle(e/2,t/2,e,t,0,.5),this.background.setOrigin(.5,.5),this.characterContainer=this.add.container(0,0),this.textures.exists("textbox"))this.textbox=this.add.image(e/2,t-60,"textbox");else{const a=Math.min(e-40,700),s=Math.min(150,.25*t);this.textbox=this.add.rectangle(e/2,t-60,a,s,0,.8)}if(this.textbox.setOrigin(.5,.5),this.textures.exists("namebox"))this.namebox=this.add.image(.2*e,t-100,"namebox");else{const a=Math.min(200,.4*e),s=Math.min(50,.08*t);this.namebox=this.add.rectangle(.2*e,t-100,a,s,0,.8)}this.namebox.setOrigin(.5,.5);const a=Math.min(e-80,600),s=e<600?"18px":"24px";this.dialogText=this.add.text(e/2,t-60,"",{fontSize:s,fill:"#ffffff",lineSpacing:8,padding:{x:10,y:10},wordWrap:{width:a,useAdvancedWrap:!0},fixedHeight:50}),this.dialogText.setOrigin(.5,.5);const r=e<600?"16px":"20px";this.nameText=this.add.text(.2*e,t-100,"",{fontSize:r,fill:"#ffffff",fontStyle:"bold",padding:{x:10,y:10},fixedHeight:50}),this.nameText.setOrigin(.5,.2),this.input.removeAllListeners("pointerdown"),this.input.on("pointerdown",(()=>{this.nextDialog()})),this.input.keyboard.on("keydown-SPACE",(()=>{this.nextDialog()})),this.isUICreated=!0}resetUI(){this.dialogText&&this.dialogText.setText(""),this.nameText&&this.nameText.setText(""),this.background&&(this.background.destroy(),this.background=null)}startConversation(e){this.currentConversation=e,this.currentConversationIndex=0,this.updateBackground(e.background),this.switchToEventBgm(e.bgm),this.showDialog()}nextDialog(){this.isTextAnimating?this.completeTextAnimation():(this.currentConversationIndex++,this.currentConversationIndex<this.currentConversation.conversations.length?this.showDialog():this.endConversation())}showDialog(){const e=this.currentConversation.conversations[this.currentConversationIndex],t=!e.speaker||"narrator"===e.character;t?this.characterSprites&&Object.values(this.characterSprites).forEach((e=>{e&&e.setVisible&&e.setVisible(!1)})):(this.characterSprites&&Object.values(this.characterSprites).forEach((e=>{e&&e.setVisible&&e.setVisible(!0)})),this.updateCharacterSprite(e.character,e.expression)),t?(this.nameText.setText(""),this.namebox&&this.namebox.setVisible(!1),this.nameText&&this.nameText.setVisible(!1)):(this.namebox&&this.namebox.setVisible(!0),this.nameText&&this.nameText.setVisible(!0),this.nameText.setText(e.speaker||"")),this.animateText(e.text)}updateCharacterSprite(e,t){if(this.characterSprites||(this.characterSprites={}),this.characterContainer){if(e&&t){const a=`${e}_${t}`,s=this.sys?.game?.canvas?.width||this.sys?.game?.config?.width||800,r=this.sys?.game?.canvas?.height||this.sys?.game?.config?.height||600,i={heroine:{x:.7*s,y:.4*r},friend:{x:.3*s,y:.4*r},teacher:{x:.5*s,y:.4*r},kawamuro:{x:.7*s,y:.4*r},daichi:{x:.3*s,y:.4*r},naoki:{x:.5*s,y:.4*r}}[e]||{x:.7*s,y:.4*r};if(this.characterSprites[e]){const t=this.characterSprites[e];t.texture.key!==a&&t.setTexture(a)}else{const t=this.add.image(i.x,i.y,a);t.setOrigin(.5,.5),this.characterContainer.add(t),this.characterSprites[e]=t,t.setAlpha(0),t.setScale(.8),this.tweens.add({targets:t,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Power2"})}this.dimOtherCharacters(e)}}else console.warn("characterContainer is not initialized yet")}dimOtherCharacters(e){this.characterSprites&&Object.keys(this.characterSprites).forEach((t=>{const a=this.characterSprites[t];t===e?a.setTint(16777215):a.setTint(8947848)}))}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}animateText(e){if(this.isTextAnimating=!0,this.dialogText.setText(""),this.isMobile())return this.dialogText.setText(e),void(this.isTextAnimating=!1);let t="",a=0;const s=this.time.addEvent({delay:this.textSpeed,callback:()=>{a<e.length?(t+=e[a],this.dialogText.setText(t),a++):(this.isTextAnimating=!1,s.destroy())},loop:!0});this.currentTextTimer=s}completeTextAnimation(){this.currentTextTimer&&this.currentTextTimer.destroy();const e=this.currentConversation.conversations[this.currentConversationIndex];this.dialogText.setText(e.text),this.isTextAnimating=!1}updateBackground(e){if(e&&this.textures.exists(e)){this.background&&this.background.destroy();const t=this.sys?.game?.canvas?.width||this.sys?.game?.config?.width||800,a=this.sys?.game?.canvas?.height||this.sys?.game?.config?.height||600;this.background=this.add.image(t/2,a/2,e),this.background.setOrigin(.5,.5);const s=t/this.background.width,r=a/this.background.height,i=Math.max(s,r);this.background.setScale(i),this.background.setDepth(-1)}}switchToEventBgm(e){const t=this.scene.get("Stage1Scene")||this.scene.get("Stage2Scene")||this.scene.get("Stage3Scene")||this.scene.get("MiemachiStage")||this.scene.get("TaketastageStage")||this.scene.get("JapanStage");if(t&&t.audioManager)if(this.originalBgm=t.audioManager.bgm,e){const a=e.startsWith("bgm_")?e:`bgm_${e}`;t.audioManager.playBgm(a,.3,!0)}else t.audioManager.playBgm("bgm_event",.3,!0)}restoreOriginalBgm(){try{const e=this.scene.get("Stage1Scene")||this.scene.get("Stage2Scene")||this.scene.get("Stage3Scene")||this.scene.get("MiemachiStage")||this.scene.get("TaketastageStage")||this.scene.get("JapanStage");if(e&&e.audioManager){e.audioManager.stopBgm(!1);const t=this.getOriginalBgmKey();t&&e.audioManager.playBgm(t,.3,!0)}}catch(e){}}getOriginalBgmKey(){const e=this.scene.get("Stage1Scene")||this.scene.get("Stage2Scene")||this.scene.get("Stage3Scene")||this.scene.get("MiemachiStage")||this.scene.get("TaketastageStage")||this.scene.get("JapanStage");if(e){if("Stage1Scene"===e.scene.key)return"bgm_map";if("Stage2Scene"===e.scene.key)return"bgm_stage2";if("Stage3Scene"===e.scene.key)return"bgm_stage3";if("MiemachiStage"===e.scene.key||"TaketastageStage"===e.scene.key||"JapanStage"===e.scene.key)return"bgm_map"}return"bgm_map"}endConversation(){try{this.restoreOriginalBgm(),this.cleanupCharacterSprites(),this.currentTextTimer&&(this.currentTextTimer.destroy(),this.currentTextTimer=null),this.resetUI(),this.events.emit("conversationEnded"),this.scene.stop()}catch(e){console.error("[ConversationScene] Error in endConversation:",e);try{this.scene.stop()}catch(e){console.error("[ConversationScene] Error stopping scene:",e)}}}cleanupCharacterSprites(){this.characterSprites&&(Object.values(this.characterSprites).forEach((e=>{e&&e.destroy&&e.destroy()})),this.characterSprites={}),this.characterContainer&&this.characterContainer.removeAll()}resize(e){const{width:t,height:a}=e;if(this.background){this.background.setPosition(t/2,a/2);const e=t/this.background.width,s=a/this.background.height,r=Math.max(e,s);this.background.setScale(r)}if(this.textbox){this.textbox.setPosition(t/2,a-60);const e=Math.min(t-40,700),s=Math.min(150,.25*a);this.textbox.setDisplaySize(e,s)}if(this.namebox){this.namebox.setPosition(.2*t,a-100);const e=Math.min(200,.4*t),s=Math.min(50,.08*a);this.namebox.setDisplaySize(e,s)}if(this.dialogText){this.dialogText.setPosition(t/2,a-60);const e=Math.min(t-80,600);this.dialogText.setWordWrapWidth(e);const s=t<600?"18px":"24px";this.dialogText.setFontSize(s)}if(this.nameText){this.nameText.setPosition(.2*t,a-100);const e=t<600?"16px":"20px";this.nameText.setFontSize(e)}this.repositionCharacterSprites()}repositionCharacterSprites(){if(this.characterSprites){const e=this.sys?.game?.canvas?.width||this.sys?.game?.config?.width||800,t=this.sys?.game?.canvas?.height||this.sys?.game?.config?.height||600,a={heroine:{x:.7*e,y:.4*t},friend:{x:.3*e,y:.4*t},teacher:{x:.5*e,y:.4*t},hirokazu:{x:.7*e,y:.4*t},daichi:{x:.3*e,y:.4*t},naoki:{x:.5*e,y:.4*t}};Object.keys(this.characterSprites).forEach((s=>{const r=this.characterSprites[s],i=a[s]||{x:.7*e,y:.4*t};r&&r.setPosition&&r.setPosition(i.x,i.y)}))}}}class b{constructor(e){this.scene=e,this.bgm=null,this.bgmVolume=.3,this.seVolume=.7,this.voiceVolume=.8,this.isBgmMuted=!1,this.isSeMuted=!1,this.isVoiceMuted=!1,this.loadedSounds=new Set}loadSound(e,t){this.loadedSounds.has(e)||(this.scene.load.audio(e,t),this.loadedSounds.add(e))}playBgm(e,t=this.bgmVolume,a=!0){if(this.bgm){if(this.bgm.key===e)return;this.stopBgm(a,(()=>{this.startNewBgm(e,t,a)}))}else this.startNewBgm(e,t,a)}startNewBgm(e,t,a){if(!this.isBgmMuted)try{if(!this.scene||!this.scene.sound)return void console.warn("[AudioManager] Scene or sound system is not available for BGM:",e);this.bgm=this.scene.sound.add(e,{loop:!0,volume:a?0:t}),this.bgm.play(),a?this.scene.tweens.add({targets:this.bgm,volume:t,duration:500}):this.bgm.setVolume(t)}catch(t){console.error(`[AudioManager] BGM ${e} の再生に失敗しました:`,t)}}stopBgm(e=!0,t){if(this.bgm)try{if(!this.scene||!this.scene.sound)return console.warn("[AudioManager] Scene or sound system is not available for stopping BGM"),this.bgm=null,void(t&&t());if(!this.bgm.isPlaying&&!this.bgm.isPaused)return console.warn("[AudioManager] BGM is not playing or paused"),this.bgm=null,void(t&&t());if(e)this.scene.tweens.add({targets:this.bgm,volume:0,duration:500,onComplete:()=>{try{this.bgm&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=null}catch(e){console.warn("[AudioManager] Error during BGM stop:",e),this.bgm=null}t&&t()}});else{try{this.bgm&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=null}catch(e){console.warn("[AudioManager] Error during BGM stop:",e),this.bgm=null}t&&t()}}catch(e){console.warn("[AudioManager] Error in stopBgm:",e),this.bgm=null,t&&t()}else t&&t()}playSe(e,t=this.seVolume){if(!this.isSeMuted)if(this.scene&&this.scene.sound)try{const a=this.scene.sound.add(e,{volume:t});a.play(),a.once("complete",(()=>{a.destroy()}))}catch(t){console.error(`SE ${e} の再生に失敗しました:`,t)}else console.warn("[AudioManager] Scene or sound system is not available for SE:",e)}playVoice(e,t=this.voiceVolume){if(!this.isVoiceMuted)if(this.scene&&this.scene.sound)try{const a=this.scene.sound.add(e,{volume:t});a.play(),a.once("complete",(()=>{a.destroy()}))}catch(t){console.error(`Voice ${e} の再生に失敗しました:`,t)}else console.warn("[AudioManager] Scene or sound system is not available for Voice:",e)}setBgmVolume(e){this.bgmVolume=e,this.bgm&&this.bgm.setVolume(e)}setSeVolume(e){this.seVolume=e}setVoiceVolume(e){this.voiceVolume=e}muteBgm(e){this.isBgmMuted=e,this.bgm&&this.bgm.setMute(e)}muteSe(e){this.isSeMuted=e}muteVoice(e){this.isVoiceMuted=e}muteAll(e){this.muteBgm(e),this.muteSe(e),this.muteVoice(e)}stopAll(){this.stopBgm(!1),this.scene&&this.scene.sound&&(this.scene.sound.stopAll(),this.scene.sound.getAllPlaying().forEach((e=>{e.stop(),e.destroy()})))}destroy(){this.stopAll(),this.bgm&&(this.bgm.stop(),this.bgm.destroy(),this.bgm=null),this.loadedSounds.forEach((e=>{try{this.scene.cache.audio.exists(e)&&this.scene.cache.audio.remove(e)}catch(t){console.warn(`Failed to remove audio cache for key: ${e}`,t)}})),this.loadedSounds.clear(),this.scene=null}}class C extends Phaser.Scene{constructor(){super({key:"Stage1Scene"}),this.mapManager=null,this.playerController=null,this.touchControlManager=null,this.uiManager=null,this.cameraManager=null,this.inputManager=null,this.collisionManager=null,this.behaviorManager=null,this.dialogSystem=null,this.audioManager=null,this.conversationTrigger=null,this.updateCounter=0}preload(){this.load.tilemapTiledJSON("map","assets/maps/stage1.tmj"),this.load.image("[A]Grass1_pipo","assets/maps/tilesets/stage1/[A]Grass1_pipo.png"),this.load.image("Tilemap","assets/maps/tilesets/stage1/Tilemap.png"),this.load.audio("bgm_nightbarth","assets/audio/bgm/nightbarth.mp3"),this.load.audio("bgm_demo_chinpo","assets/audio/bgm/stage1/megarovania.mp3"),this.load.on("filecomplete-audio-bgm_menu",(()=>{}));const e={frameWidth:32,frameHeight:32};this.load.spritesheet("ojyama1","assets/characters/enemies/pipo-charachip005a.png",e),this.load.spritesheet("hanni","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("kuccoro","assets/characters/npcs/pipo-charachip022e.png",e),this.load.spritesheet("kuccoro1","assets/characters/npcs/pipo-charachip022a.png",e),this.load.spritesheet("kuccoro2","assets/characters/npcs/pipo-charachip022e.png",e),this.load.spritesheet("kuccoro3","assets/characters/npcs/pipo-charachip026.png",e),this.load.spritesheet("kuccoro4","assets/characters/npcs/pipo-charachip024d.png",e),this.load.spritesheet("enemy1","assets/characters/enemies/pipo-charachip005a.png",e),this.load.spritesheet("enemy2","assets/characters/enemies/pipo-charachip005a.png",e),this.load.spritesheet("friend1","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("kuccoro","assets/characters/npcs/pipo-charachip022a.png",e),this.load.on("fileerror",(()=>{})),this.load.on("complete",(()=>{})),this.load.image("hirokazu_A","assets/characters/portraits/hirokazu_A.png"),this.load.image("hirokazu_B","assets/characters/portraits/hirokazu_B.png"),this.load.image("hirokazu_C","assets/characters/portraits/hirokazu_C.png"),this.load.image("hirokazu_D","assets/characters/portraits/hirokazu_D.png"),this.load.image("hirokazu_E","assets/characters/portraits/hirokazu_E.png"),this.load.image("hirokazu_F","assets/characters/portraits/hirokazu_F.png"),this.load.image("daichi_A","assets/characters/portraits/daichi_A.png"),this.load.image("naoki_A","assets/characters/portraits/naoki_A.png"),this.load.image("test_1","assets/backgrounds/background_test.png"),this.load.audio("se_touch_stage1","assets/audio/se/touch_1.mp3")}create(){try{this.audioManager=new b(this),this.audioManager.playBgm("bgm_nightbarth",.3),this.collisionManager=new u(this),this.collisionManager.setupCollisionGroups(),this.dialogSystem=new d(this,x),this.collisionManager.setDialogSystem(this.dialogSystem),this.behaviorManager=new g(this),this.mapManager=new i(this),this.mapManager.createMap(),this.playerController=new n(this),this.playerController.createPlayer(100,100),this.inputManager=new l,this.inputManager.setupKeyboard(this,this.playerController),this.touchControlManager=new c(this,this.playerController.player,"se_touch_stage1"),this.uiManager=new h,this.uiManager.createUI(this),this.cameraManager=new p(this),this.cameraManager.setupCamera(this,this.mapManager.map,this.playerController.player),this.collisionManager.setupAllCollisions(this.playerController.player,this.mapManager),this.conversationTrigger=new y(this),this.scene.add("ConversationScene",A),this.setupConversationEvents(),this.events.on("shutdown",this.shutdown,this)}catch{}}shutdown(){this.audioManager&&(this.audioManager.stopAll(),this.audioManager.destroy(),this.audioManager=null),this.playerController&&(this.playerController.destroy(),this.playerController=null),this.touchControlManager&&(this.touchControlManager.destroy(),this.touchControlManager=null),this.uiManager&&(this.uiManager.destroy(),this.uiManager=null),this.cameraManager&&(this.cameraManager.destroy(),this.cameraManager=null),this.inputManager&&(this.inputManager.destroy(),this.inputManager=null),this.collisionManager&&(this.collisionManager.destroy(),this.collisionManager=null),this.behaviorManager&&(this.behaviorManager.destroy(),this.behaviorManager=null),this.dialogSystem&&(this.dialogSystem.destroy(),this.dialogSystem=null),this.conversationTrigger&&(this.conversationTrigger.destroy(),this.conversationTrigger=null),this.sound&&this.sound.stopAll(),this.events.off("shutdown",this.shutdown,this)}destroy(){this.shutdown(),super.destroy()}setupConversationEvents(){this.setupNpcConversations(),this.setupAreaTriggers(),this.setupProximityTriggers()}setupNpcConversations(){const e=this.mapManager.getNpcSprite("hanni");e&&this.conversationTrigger.setupNpcClickHandler(e,"demo_chinpo")}setupAreaTriggers(){this.conversationTrigger.setupAreaTrigger(200,200,64,64,"after_chinpo")}setupProximityTriggers(){this.conversationTrigger.setupProximityTrigger(300,300,50,"library_scene")}update(){this.updateCounter++,this.updateCounter%2==0&&(this.playerController.update(),this.uiManager.updatePlayerPosition(this.playerController.player))}resize(e){const{width:t,height:a}=e;this.cameras.resize(t,a)}}class _{constructor(e){this.scene=e}setupObjectBehavior(e,t){switch(t.type){case"npc":this.setupNpcBehavior(e,t);break;case"item":this.setupItemBehavior(e);break;case"enemy":this.setupEnemyBehavior(e,t)}}setupNpcBehavior(e,t){switch(t.name){case"friend2_4":this.setupFriend2Animation(e);break;case"shopkeeper":this.setupShopkeeperAnimation(e);break;case"guard":this.setupGuardAnimation(e);break;case"merchant":this.setupMerchantAnimation(e)}}setupItemBehavior(e){this.scene.tweens.add({targets:e,alpha:.5,scale:1.2,duration:800,yoyo:!0,repeat:-1,ease:"Power2"})}setupEnemyBehavior(e,t){switch(t.name){case"boss_stage2":this.setupBossAnimation(e);break;case"strong_enemy":this.setupStrongEnemyAnimation(e);break;default:this.setupDefaultEnemyAnimation(e)}}setupFriend2Animation(e){this.scene.tweens.add({targets:e,alpha:.8,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setupShopkeeperAnimation(e){this.scene.tweens.add({targets:e,rotation:.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Power1"})}setupGuardAnimation(e){this.scene.tweens.add({targets:e,x:e.x+40,duration:3e3,yoyo:!0,repeat:-1,ease:"Linear"})}setupMerchantAnimation(e){this.scene.tweens.add({targets:e,y:e.y+8,duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setupBossAnimation(e){this.scene.tweens.add({targets:e,scale:1.2,rotation:.2,duration:1500,yoyo:!0,repeat:-1,ease:"Power2"})}setupStrongEnemyAnimation(e){this.scene.tweens.add({targets:e,x:e.x+60,y:e.y+20,duration:1e3,yoyo:!0,repeat:-1,ease:"Back.easeInOut"})}setupDefaultEnemyAnimation(e){this.scene.tweens.add({targets:e,x:e.x+35,rotation:Math.PI/8,duration:2e3,yoyo:!0,repeat:-1,ease:"Power2"})}startConversation(e){this.scene.collisionManager&&this.scene.collisionManager.startConversation(e)}}const f={friend2_4:{name:"ひろかず",messages:["もこうにドンキあるから","そこで、５０万かたしてもらって","もいいい？"]},friend2_5:{name:"くず",messages:["はらめおらぁ"]},guard:{name:"ポルノさん",messages:["できたら愛してくだーさい","僕の肩で羽を休めておくれー"]},kuccoro:{name:"商人",messages:["やめて！","ラーの翼神竜の特殊能力で、ギルフォード・ザ・ライトニングを焼き払われたら、","闇のゲームでモンスターと繋がってる城之内の精神まで燃え尽きちゃう！","お願い、死なないで城之内！","あんたが今ここで倒れたら、舞さんや遊戯との約束はどうなっちゃうの？","ライフはまだ残ってる。ここを耐えれば、マリクに勝てるんだから！","次回「城之内死す」デュエルスタンバイ！"]},kuccoro1:{name:"くっころ",messages:["ここまで辿り着くとはな","しかし、ここが君の限界だ！","かかってこい！","ここが貴様の墓場となろう"]},kuccoro2:{name:"エッチな女騎士",messages:["くっ、、、ころせ！","イグイグイグぅぅ！"]},kuccoro4:{name:"２コマ即落ち女騎士",messages:["くっ、、、殺せ！","イクイクイクイクイクっ、おっちんぽーーーーー！"]}};class v extends Phaser.Scene{constructor(){super({key:"Stage2Scene"}),this.mapManager=null,this.playerController=null,this.touchControlManager=null,this.uiManager=null,this.cameraManager=null,this.inputManager=null,this.collisionManager=null,this.dialogSystem=null}preload(){this.load.tilemapTiledJSON("map","assets/maps/test_map5.tmj"),this.load.audio("bgm_pollyanna","assets/audio/bgm/Pollyanna.mp3"),this.load.image("GK_A2_C_autotile","assets/maps/tilesets/stage2/GK_A2_JC_autotile.png"),this.load.image("Preview_RPGMakerVXAce","assets/maps/tilesets/stage2/Preview_RPGMakerVXAce.png"),this.load.image("Preview","assets/maps/tilesets/stage2/Preview.png"),this.load.image("GK_JC_A5_2","assets/maps/tilesets/stage2/GK_JC_A5_2.png"),this.load.image("GK_JC_B_2","assets/maps/tilesets/stage2/GK_JC_B_2.png"),this.load.image("Tilemap","assets/maps/tilesets/stage2/Tilemap.png"),this.load.image("pipo-map001_at-kusa","assets/maps/tilesets/stage2/pipo-map001_at-kusa.png");const e={frameWidth:32,frameHeight:32};this.load.spritesheet("enemy1","assets/characters/enemies/pipo-charachip005a.png",e),this.load.spritesheet("friend2_6","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2_5","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2_4","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2_3","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2_2","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("friend2_1","assets/characters/npcs/pipo-charachip007a.png",e),this.load.spritesheet("kuccoro1","assets/characters/npcs/pipo-charachip022a.png",e),this.load.spritesheet("kuccoro","assets/characters/npcs/pipo-charachip022e.png",e),this.load.spritesheet("kuccoro2","assets/characters/npcs/pipo-charachip024d.png",e),this.load.audio("se_touch_stage2","assets/audio/se/touch_3.mp3"),this.load.on("complete",(()=>{}))}create(){this.audioManager=new b(this),this.audioManager.playBgm("bgm_pollyanna",.5),this.collisionManager=new u(this),this.collisionManager.setupCollisionGroups(),this.dialogSystem=new d(this,f),this.collisionManager.setDialogSystem(this.dialogSystem),this.behaviorManager=new _(this),this.mapManager=new i(this),this.mapManager.createMap(),this.playerController=new n(this),this.playerController.createPlayer(100,100),this.inputManager=new l,this.inputManager.setupKeyboard(this,this.playerController),this.touchControlManager=new c(this,this.playerController.player,"se_touch_stage2"),this.uiManager=new h,this.uiManager.createUI(this),this.cameraManager=new p(this),this.cameraManager.setupCamera(this,this.mapManager.map,this.playerController.player),this.collisionManager.setupAllCollisions(this.playerController.player,this.mapManager),this.events.on("shutdown",this.shutdown,this)}shutdown(){this.audioManager&&this.audioManager.stopAll&&(this.audioManager.stopAll(),this.audioManager.bgm&&this.audioManager.bgm.destroy&&(this.audioManager.bgm.destroy(),this.audioManager.bgm=null)),this.sound&&this.sound.stopAll()}update(){if(this.dialogSystem&&this.dialogSystem.isDialogActive())return this.playerController.player.setVelocityX(0),void this.playerController.player.setVelocityY(0);this.playerController&&this.playerController.update(),this.updateCounter||(this.updateCounter=0),this.updateCounter++,this.updateCounter%2==0&&this.uiManager&&this.playerController&&this.uiManager.updatePlayerPosition(this.playerController.player)}resize(e){const{width:t,height:a}=e;this.cameras.resize(t,a)}destroy(){this.shutdown(),super.destroy()}}class M extends Phaser.Scene{constructor(){super({key:"Stage3Scene"}),this.mapManager=null,this.playerController=null,this.touchControlManager=null,this.uiManager=null,this.cameraManager=null,this.inputManager=null,this.collisionManager=null,this.audioManager=null,this.updateCounter=0}preload(){this.load.tilemapTiledJSON("map","assets/test_map5.tmj"),this.load.audio("bgm_stage3","assets/audio/bgm/stage1/kessen_diaruga.mp3"),this.load.audio("se_touch_stage3","assets/audio/se/touch_6.mp3"),this.load.on("complete",(()=>{}))}create(){this.audioManager=new b(this),this.audioManager.playBgm("bgm_stage3",.3),this.collisionManager=new u(this),this.collisionManager.setupCollisionGroups(),this.mapManager=new i(this),this.mapManager.createMap(),this.playerController=new n(this),this.playerController.createPlayer(100,100),this.touchControlManager=new c(this,this.playerController.player,"se_touch_stage3"),this.uiManager=new h,this.uiManager.createUI(this),this.cameraManager=new p(this),this.cameraManager.setupCamera(this,this.mapManager.map,this.playerController.player),this.inputManager=new l,this.inputManager.setupKeyboard(this,this.playerController),this.collisionManager.setupAllCollisions(this.playerController.player,this.mapManager),this.events.on("shutdown",this.shutdown,this)}shutdown(){this.audioManager&&this.audioManager.stopAll&&(this.audioManager.stopAll(),this.audioManager.bgm&&this.audioManager.bgm.destroy&&(this.audioManager.bgm.destroy(),this.audioManager.bgm=null)),this.sound&&this.sound.stopAll()}update(){this.playerController&&this.playerController.update(),this.updateCounter||(this.updateCounter=0),this.updateCounter++,this.updateCounter%2==0&&this.uiManager&&this.playerController&&this.uiManager.updatePlayerPosition(this.playerController.player)}resize(e){const{width:t,height:a}=e;this.cameras.resize(t,a)}destroy(){this.shutdown(),this.mapManager&&this.mapManager.destroy&&this.mapManager.destroy(),this.audioManager&&this.audioManager.destroy&&this.audioManager.destroy(),this.touchControlManager&&this.touchControlManager.destroy&&this.touchControlManager.destroy(),this.collisionManager&&this.collisionManager.destroy&&this.collisionManager.destroy(),this.dialogSystem&&this.dialogSystem.destroy&&this.dialogSystem.destroy(),super.destroy()}}const S={lunch_tag:{background:"classroom",bgm:"Fantasy",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"なんか、今鬼ごっこしたくね？",expression:"A"},{speaker:"だいち",character:"daichi",text:"いやっ、うーん、、、したいなぁ、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"おらぁ、、、たっち",expression:"A"},{speaker:"なおき",character:"naoki",text:"えっ？？？？いきなり？",expression:"A"},{speaker:"なおき",character:"naoki",text:"なら、あ、、はい",expression:"A"},{speaker:"かなと",character:"kanato",text:"おおっと、順応はえーんだよ",expression:"A"},{speaker:"ひろかず、なおき、こうたろう、だいち、あきざわ、しゅうへい",character:"hirokazu",text:"にげろぉぉぉ！！！！！",expression:"C"},{speaker:"かなと",character:"kanato",text:"おらぁぁぁぁ！！！！！",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"ばりあーーーーーーーーー！！！！",expression:"D"},{speaker:"かなと",character:"kanato",text:"それだけは、しちゃだめだろぉぉぉ！！",expression:"C"},{speaker:"かなと",character:"kanato",text:"あーーくそぉ、、なんで、高校生になって鬼ごっこしなきゃならんのだ",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"ばりあーーーーーーーーー！！！！",expression:"D"},{speaker:"かなと",character:"kanato",text:"だから、だめだろ！！！！",expression:"C"},{speaker:"かなと",character:"kanato",text:"、、、、、、、、",expression:"E"},{speaker:"かなと",character:"kanato",text:"これは、ゲームじゃない、いじめだ、、、",expression:"F"}]},gospellers_song:{background:"classroom",bgm:"Fantasy",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"ゴスペラーズの「ひとり」を歌うぞ、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"えっ、なんで？",expression:"A"},{speaker:"かなと",character:"kanato",text:"まぁ、やるか、、、",expression:"B"},{se:"hitori"},{speaker:"ひろかず,だいち,こうたろう,かなと",character:"hirokazu,daichi,koutarou,kanato",text:"、、、、、やめよう",expression:"B"}]},climbing_injury:{background:"classroom",bgm:"Fantasy",conversations:[{speaker:"かなと",character:"kanato",text:"あれ、ひろかずどうした？その指？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"クライミングでケガした",expression:"D"}]},classroom_lock_incident:{background:"classroom_door",bgm:"Jounetsu_Tairiku",conversations:[{speaker:"安藤先生",character:"ando_sensei",text:"なんかしまってる",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"反対側に行く、こっちもしまっている",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"ちょっと、工藤あけて",expression:"C"},{speaker:"工藤",character:"kudo",text:"ヴぉ。",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"（あけて閉めろ）",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"がちゃがちゃり（２回なる）",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"あいてないぞ！もう一度",expression:"F"},{speaker:"ひろかず",character:"hirokazu",text:"反対側は？",expression:"C"},{speaker:"工藤",character:"kudo",text:"ヴぉ。",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"（あけて閉めろ）",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"がちゃがちゃり（２回なる）",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"ここも空いてない、あけて",expression:"F"},{speaker:"ひろかず",character:"hirokazu",text:"おい！わざとしめただろ",expression:"G"},{speaker:"工藤",character:"kudo",text:"。。。",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"（工藤閉めろ）",expression:"D"},{speaker:"工藤",character:"kudo",text:"ヴぉ。",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"たったったッ（がチャリ）",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"いま、しめただろ！！！",expression:"G"},{speaker:"ひろかず",character:"hirokazu",text:"ひろかず、逃走",expression:"H"},{speaker:"工藤",character:"kudo",text:"工藤　逃げ遅れる",expression:"D"}]},koutarou_toilet:{background:"classroom",bgm:"Fantasy",conversations:[{speaker:"こうたろう",character:"koutarou",text:"俺おしっこ近いんよね、",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"おしっこ行ってくるわ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"１限目休憩",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"おしっこ行ってくるわ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"２限目休憩",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"水飲だからかな、おしっこ行ってくるわ",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"うんこも、行ってくるわ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"、、、",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"３分後",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"早くね？",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"おれ、うんこめっちゃ早いんよね",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"3限目休憩",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"おしっこ行ってくるわ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"こうたろう、俺も行ってくるわ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"いや、お前は行っちゃダメだ",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"なんで？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"膀胱でかいから",expression:"D"},{speaker:"こうたろう",character:"koutarou",text:"かんけいないだろ。。、",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"４限目終了昼休み",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"よし、こうたろう、いっていいぞ",expression:"A"},{speaker:"他",character:"others",text:"（こうたろうは膀胱大きいんだな）",expression:"B"},{speaker:"ナレーション",character:"narrator",text:"ひろかずにより、この日からこうたろうは昼休みまでおしっこにいけなくなった",expression:"A"}]},culture_festival_apology:{background:"classroom",bgm:"Nagisa_Moderato",conversations:[{speaker:"先生",character:"teacher",text:"とりあえず、教職員の会議があるから、いったん教室で待機しといて",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"、、、、、、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"今帰ったら、４：３０の電車にまにあう！",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"竹田は一時間に１本しか電車がない",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"おい、行くぞ！",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"たったったっ（ｓE）",expression:"F"},{speaker:"先生",character:"teacher",text:"次の日",expression:"A"},{speaker:"先生",character:"teacher",text:"えー、みんながちゃんと待っている間輪をみだして、先に帰った者がいます、",expression:"C"},{speaker:"先生",character:"teacher",text:"前にでて、一人づつ反省の言葉を言ってください",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"先にかえって申し訳ありませんでした！",expression:"E"},{speaker:"先生",character:"teacher",text:"えー、先に帰ったので責任とって、今回の席替えは帰った人全員一番前の席になります",expression:"F"},{speaker:"ひろかず",character:"hirokazu",text:"くっ、、、",expression:"G"}]},train_no_poop_man:{background:"station",bgm:"Nagisa_Moderato",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"電車内うんこおじさん事件",expression:"A"}]},ginnga_water:{background:"galaxy",bgm:"nightbarth",conversations:[{text:"銀河と書いている水がウィンドウに置いてある",expression:"A"},{text:"その下に１５００円と書いてある、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"たっか！！！！！！！！",expression:"B"}]},taketa_station:{background:"station",bgm:"nightbarth",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"竹田駅だ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"電車で来たな",expression:"B"}]},videocamera_broken:{background:"classroom",bgm:"Fantasy",conversations:[{speaker:"かなと",character:"kanato",text:"ちょっと、みしろー",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"なにー？",expression:"A"},{speaker:"かなと",character:"kanato",text:"ごめん、ビデオカメラ落とした、そして、割れた、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"今度、修理代払うわ、、、",expression:"D"},{speaker:"かなと",character:"kanato",text:"まじかーー、しゃーないなぁ、、、",expression:"C"},{speaker:"ナレーション",character:"narrator",text:"12年後、いまだにビデオカメラが直ることはないようだ",expression:"A"}]},drama_filming:{background:"classroom",bgm:"nightbarth",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"せっかくビデオカメラあるし、なんか、ドラマを撮ろう",expression:"A"},{speaker:"かなと",character:"kanato",text:"まぁ、ええけど何をとる？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"じゃあ、各々座ってくれ、ほら",expression:"A"},{speaker:"だいち、こうたろう、しゅうへい、まさと、かなと",character:"daichi,koutarou,shuuhei,masato,kanato",text:"まぁ、了解",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"おれには自信のある、アイデアがあるんだ",expression:"A"},{speaker:"かなと",character:"kanato",text:"アイデアとは？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"まさとが教師訳で、順番に当てていくから最後みしろは▢ってますっていって、立つな",expression:"A"},{speaker:"かなと",character:"kanato",text:"・・・・・",expression:"C"},{speaker:"だいち、こうたろう、しゅうへい、まさと",character:"daichi,koutarou,shuuhei,masato",text:"了解！",expression:"B"},{speaker:"かなと",character:"kanato",text:"えっ、なんも、理解できなかったんだけど？",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"はい位置についてー",expression:"A"},{speaker:"まさと",character:"masato",text:"きりーつ、礼！",expression:"A"},{speaker:"だいち、しゅうへい、こうたろう",character:"daichi,shuuhei,koutarou",text:"おねがいしまーす！",expression:"B"},{speaker:"かなと",character:"kanato",text:"ちょっ、まてよ、、",expression:"C"},{speaker:"まさと",character:"masato",text:"きょうはキノコについて、授業をする",expression:"A"},{speaker:"まさと",character:"masato",text:"きのことはなんだ？だいち。席を立ってこたえてみろ",expression:"A"},{speaker:"かなと",character:"kanato",text:"拒否はできないんですかね？",expression:"C"},{speaker:"だいち",character:"daichi",text:"菌です。",expression:"B"},{speaker:"まさと",character:"masato",text:"そうだ、ではキノコはどこにはえる？こうたろうこたえてみろ",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"森などじめじめしたところに生えることが多いです",expression:"B"},{speaker:"かなと",character:"kanato",text:"拒否権はないんですかね？？？？？？",expression:"C"},{speaker:"まさと",character:"masato",text:"正解だ、じゃ、このきのこはなんていうんだ？しゅうへい",expression:"A"},{speaker:"しゅうへい",character:"shuuhei",text:"しいたけです",expression:"B"},{speaker:"かなと",character:"kanato",text:"ないんですね！くそがっ",expression:"C"},{speaker:"まさと",character:"masato",text:"そうだな、これはよく食卓などで食べられるきのこだ",expression:"A"},{speaker:"まさと",character:"masato",text:"じゃあ、次は、これは何ていうんだ？みしろー",expression:"A"},{speaker:"かなと",character:"kanato",text:"、、、、、",expression:"C"},{speaker:"かなと",character:"kanato",text:"、、、、、、、、、、すみません、▢ってます。",expression:"C"},{speaker:"まさと",character:"masato",text:"どうしたー？みしろー",expression:"B"},{speaker:"かなと",character:"kanato",text:"あっ、いや、▢ってます。",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"ミシロどうした？ちゃんと立てよ",expression:"D"},{speaker:"だいち",character:"daichi",text:"かなとどうした？ほら立てよ",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"ほらぁ",expression:"B"},{speaker:"しゅうへい",character:"shuuhei",text:"みしろどうした？",expression:"B"},{speaker:"かなと",character:"kanato",text:"だから、▢ってます。もうすでに▢ってます。",expression:"C"},{speaker:"ひろかず、だいち、こうたろう、しゅうへい、まさと",character:"hirokazu,daichi,koutarou,shuuhei,masato",text:"・・・・・",expression:"C"},{speaker:"しゅうへい",character:"shuuhei",text:"うわーーー",expression:"C"},{speaker:"だいち",character:"daichi",text:"・・・",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"、、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"きもちわるいなぁ",expression:"D"},{speaker:"かなと",character:"kanato",text:"ひろかずさん、オブラートって知ってます？",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"当たり前だろ。薬も言葉も包める便利なものさ",expression:"A"},{speaker:"かなと",character:"kanato",text:"じゃあ、包めよ！！！その、言葉の刃をさぁ、やらせたの、お前じゃねーか！",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"・・・",expression:"C"},{speaker:"かなと",character:"kanato",text:"やらせといて、引くのやめてもらえます？",expression:"C"},{speaker:"まさと",character:"masato",text:"みしろ、不正解",expression:"D"},{speaker:"かなと",character:"kanato",text:"うるせーよ！",expression:"C"},{speaker:"かなと",character:"kanato",text:"ってか、損するの俺だけじゃねーかよ。",expression:"C"},{speaker:"だいち",character:"daichi",text:"そうだよ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"まぁ、座れよ",expression:"A"},{speaker:"かなと",character:"kanato",text:"最初から、立ってねーよ！？",expression:"C"}]},kannnamu_kudou:{background:"train",bgm:"Fantasy",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"これいいな",expression:"A"},{speaker:"くどう",character:"kudo",text:"ふんっふんっふんっ",expression:"A"},{speaker:"なおき",character:"naoki",text:"何してんの？",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"くどうにカンナムスタイルを躍らせている",expression:"A"},{speaker:"かなと",character:"kanato",text:"なんで？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"おもしろいから",expression:"A"},{speaker:"なおき、かなと、だいち",character:"naoki,kanato,daichi",text:"・・・",expression:"C"}]},arm_swinging_person:{background:"street",bgm:"Fantasy",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"なんか竹田から帰るときさ、腕をさげないでってか突き上げて、歩いてる人いるよな",expression:"A"},{speaker:"ダイチ",character:"daichi",text:"なんか見たことあるな、、",expression:"B"},{speaker:"かなと",character:"kanato",text:"その人、めっちゃ歩くのはえーんだよな、竹田でやってる塾の先生らしいけど",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ちゃんとした、歩き方おしえてもらってないんかな",expression:"B"},{speaker:"だいち",character:"daichi",text:"ちゃんとした歩き方ってなんだよ",expression:"B"},{speaker:"かなと",character:"kanato",text:"、、、まぁ、足は、正しい型だよ",expression:"A"}]},working_go_to_home_miemachi:{background:"street",bgm:"Spain",conversations:[{speaker:"かなと",character:"kanato",text:"はじめてだな、高校のメンバーで飲み会するのは",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"三重の人間は三重町で飲むからな",expression:"A"},{speaker:"だいち",character:"daichi",text:"そういえば、、、、、竹田の終電ってどうなっている、、、",expression:"B"},{speaker:"かなと",character:"kanato",text:"今何時だ？？？",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"もう、11時すぎたな、、、",expression:"B"},{speaker:"なおき",character:"naoki",text:"２２時にはもう終電なかったぞ",expression:"B"},{speaker:"かなと",character:"kanato",text:"なぜ言わない",expression:"C"},{speaker:"なおき",character:"naoki",text:"きかれなかったから",expression:"B"},{speaker:"だいち",character:"daichi",text:"馬鹿やろー",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"どうするよ、竹田はどこにも泊まるあてもないぞ",expression:"D"},{speaker:"かなと",character:"kanato",text:"タクシーは？",expression:"B"},{speaker:"なおき",character:"naoki",text:"車で３０分以上かかるから、いくらかかるかわからないぞ",expression:"B"},{speaker:"かなと",character:"kanato",text:"そもそも、一台のタクシーに５人も乗れないから、2-3で別れるしかないしな",expression:"B"},{speaker:"だいち",character:"daichi",text:"２台いるということか、、、",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"どうするか、、、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"歩いて帰るぞ！！！",expression:"A"},{speaker:"だいち",character:"daichi",text:"、、、歩くぞ！！！",expression:"A"},{speaker:"なおき",character:"naoki",text:"そうするしかないか！！！",expression:"A"},{speaker:"かなと",character:"kanato",text:"仕方ないな、やるしかねーな！！！",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"やるかっ！！",expression:"A"},{speaker:"竹田のメンバー",character:"others",text:"こいつらマジか、、、、、大丈夫か？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"おらぁ！！！！！",expression:"A"},{speaker:"竹田のメンバー",character:"others",text:"今、１２月だけど、大丈夫か？",expression:"B"},{speaker:"かなと",character:"kanato",text:"いけるいける",expression:"A"},{speaker:"だいち",character:"daichi",text:"大丈夫！！！！いける！！！！",expression:"A"},{speaker:"なおき",character:"naoki",text:"よゆーよゆー",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"マジ、よゆー",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"おらぁ、いくぞ！！！！",expression:"A"},{speaker:"竹田のメンバー",character:"others",text:"おっ、、、おっ、、まぁ、頑張れ",expression:"B"},{speaker:"ナレーション",character:"narrator",text:"１時間後",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"なんか寒くねーか？",expression:"B"},{speaker:"なおき",character:"naoki",text:"あれ、なんか寒いな",expression:"B"},{speaker:"かなと",character:"kanato",text:"寒い気がするな",expression:"B"},{speaker:"だいち",character:"daichi",text:"もしかして、アルコールのおかげだったか？",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"そうかも、しれない",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、言ってなかったんだけど、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"おれ、足にひびが入っていてあんまり、うまく歩けないんだよね、今",expression:"D"},{speaker:"だいち",character:"daichi",text:"いまいう？",expression:"C"},{speaker:"ナレーション",character:"narrator",text:"２時間後",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、これやべーさむいわ、足いてーわ",expression:"D"},{speaker:"だいち",character:"daichi",text:"これはいかんぞ",expression:"C"},{speaker:"なおき",character:"naoki",text:"なめてたかもしれん",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"それにしても、夜空はきれいだな",expression:"A"},{speaker:"かなと",character:"kanato",text:"こんなに夜空を眺めるのは久しぶりだな、きれいだ",expression:"A"},{speaker:"ナレーション",character:"narrator",text:"３時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"大丈夫か？なんか、足を引きずりながら、歩いているけど",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"あんまり大丈夫じゃない",expression:"D"},{speaker:"なおき",character:"naoki",text:"さむい、、、、人が死ぬレベル、、、",expression:"D"},{speaker:"こうたろう",character:"koutarou",text:"夜空がきれいだな、、、ステキ、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"ちょっと、やばい、とっ、とりあえず、暖を取らねーと死ぬ",expression:"C"},{speaker:"かなと",character:"kanato",text:"もうちょっといったら、コンビニがあるはず、開いているとは思うけど、、、",expression:"B"},{speaker:"ナレーション",character:"narrator",text:"４時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"コンビニ開いていたな、、助かった、、マジで",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"あ、、、アルコール買うぞ",expression:"A"},{speaker:"なおき",character:"naoki",text:"・・・",expression:"C"},{speaker:"だいち",character:"daichi",text:"なおきがしゃべらない、、、",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"酒、、、酒、、、、寒い、、空がきれい、、、きれい、、？",expression:"C"},{speaker:"ナレーション",character:"narrator",text:"５時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"なおきどうした？",expression:"B"},{speaker:"なおき",character:"naoki",text:"やばいかも、俺も足が痛いかも",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"俺この前、医者にいったんだよな",expression:"B"},{speaker:"だいち",character:"daichi",text:"なんで、歩いて帰るとかいったんだよ",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"なんか、夜空がキレイなのがムカついてきた",expression:"C"},{speaker:"なおき",character:"naoki",text:"ひろかずくん、ちょっと肩を貸しあおう、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"そうだな、、、",expression:"B"},{speaker:"なおき、ひろかず",character:"naoki,hirokazu",text:"いち、に、いち、に、いち、に、、、、、、",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"あーーーーーーーー、くそ！！！空がキレイだなぁーーーー、くそが",expression:"C"},{speaker:"ナレーション",character:"narrator",text:"６時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"あっ、みんなあきらめるな、、、歩きを止めたら、死ぬぞ",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"ちょっと、マジで死ぬぞ",expression:"C"},{speaker:"だいち",character:"daichi",text:"えぐい、えぐいえぐい、川沿いえぐいぞ、冗談抜きで凍え死ぬぞ",expression:"C"},{speaker:"ひろかず、なおき",character:"hirokazu,naoki",text:"・・・",expression:"C"},{speaker:"だいち",character:"daichi",text:"アルコールが、アルコールが、アルコールが、、、、、、、、",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"ここにきて、夜空が、めっちゃきれいに見えるのめっちゃむかついてきた",expression:"C"},{speaker:"かなと",character:"kanato",text:"さむいさむいさむい、ちょっと、冗談じゃないぞ",expression:"C"},{speaker:"かなと",character:"kanato",text:"ちょっと、皆みてみろ！！なにか、、、なにかの光が見えるぞ",expression:"A"},{speaker:"だいち、こうたろう、ひろかず、なおき",character:"daichi,koutarou,hirokazu,naoki",text:"？？？",expression:"B"},{speaker:"かなと",character:"kanato",text:"あれは、、、、、、、",expression:"B"},{speaker:"かなと",character:"kanato",text:"コインランドリーだ、、コインランドリーがあったぞ！！！！！",expression:"A"},{speaker:"だいち",character:"daichi",text:"暖がとれるかもしれない",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"とりあえず、あそこまでかんばるぞ",expression:"A"},{speaker:"ひろかず、なおき",character:"hirokazu,naoki",text:"はぁ、、、はぁ、、",expression:"C"},{speaker:"かなと",character:"kanato",text:"あと、ちょっとの辛抱だ、頑張れ！！！！",expression:"A"},{speaker:"ナレーション",character:"narrator",text:"・・・",expression:"A"},{speaker:"かなと",character:"kanato",text:"よかった、コインランドリーについた、開いているみたいだな",expression:"A"},{speaker:"だいち",character:"daichi",text:"これで、暖が取れる",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"とりあえず、少し休憩しよう",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"もうだめかと思った",expression:"B"},{speaker:"なおき",character:"naoki",text:"飲み物を買おう",expression:"A"},{speaker:"かなと",character:"kanato",text:"落ち着いたら、いくか、、、",expression:"B"},{speaker:"ナレーション",character:"narrator",text:"７時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"み、、、見えたぞ、これは、、",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"三重町だ、、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"やったぞ、、、やったぞ、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"うおおおおおおお",expression:"A"},{speaker:"なおき",character:"naoki",text:"よかった、、、よかった、、、",expression:"A"},{speaker:"かなと",character:"kanato",text:"あと、もう一息だ",expression:"A"},{speaker:"ナレーション",character:"narrator",text:"８時間後",expression:"A"},{speaker:"かなと",character:"kanato",text:"なんか、、、日が昇ってきたな",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"きれいだった、星々もみえなくなった",expression:"A"},{speaker:"だいち",character:"daichi",text:"寒さも凍えるほどではなくなってきたな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"日の光をこれほど、ありがたいと思うとは、、、",expression:"A"},{speaker:"なおき",character:"naoki",text:"やりとげたんだな、、、おれたち、、、",expression:"A"},{speaker:"かなと",character:"kanato",text:"もしかして、もう少ししたら、ジョイフルが開いているんじゃないのか？",expression:"A"},{speaker:"だいち",character:"daichi",text:"朝ご飯食べるか、、",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"そうだな、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"せっかくだし行くか、、、、",expression:"A"},{speaker:"なおき",character:"naoki",text:"うん、、、、",expression:"A"},{speaker:"ナレーション",character:"narrator",text:"ジョイフル到着",expression:"A"},{speaker:"かなと",character:"kanato",text:"なんか、涙出てきた",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"こんなにうまい、ジョイフルは初めてだ、、",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"達成感がやばいな",expression:"A"},{speaker:"なおき",character:"naoki",text:"俺たち生きてたんだな、、、",expression:"A"},{speaker:"全員",character:"all",text:"・・・・・",expression:"C"},{speaker:"だいち",character:"daichi",text:"ところで、ここまで結構歩いて帰るのにお金使ってきたけど",expression:"B"},{speaker:"だいち",character:"daichi",text:"お酒とか、自動販売機で温かい飲み物とか、ジョイフルとかで、、、",expression:"B"},{speaker:"だいち",character:"daichi",text:"タクシー代を割り勘したときの金額と変わらないってことはないよな、、、",expression:"B"},{speaker:"全員",character:"all",text:"・・・・・",expression:"C"},{speaker:"かなと",character:"kanato",text:"野暮なことを考えるのはよそうぜ、、、",expression:"B"},{speaker:"なおき",character:"naoki",text:"無事帰れたんだからな、、、",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"そうだな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"う、、、む、、、",expression:"B"},{speaker:"だいち",character:"daichi",text:"わるい、忘れてくれ",expression:"B"},{speaker:"ナレーション",character:"narrator",text:"やっぱり、歩いて帰ったほうが、高くついたのは知らないほうがよかった話",expression:"A"}]}},w={oreno_koto:{background:"test_1",bgm:"Fantasy",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"俺のことについてはなすぜ☆",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"生まれた時間は１９９６年９月２９年日曜日で晴れの日だぜ☆",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"生まれた病院は佐藤産婦人科でうまれたぜ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"名前の由来は「寛」の字はマッチョマンが気に入ってた字で、和は母さんから取ったぜ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"出産は予定日から１９日前に２６４８gで生まれたぜ☆",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"血液型はAB型だぜ☆",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"安産だったらしいぜ",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"生まれた時髪の毛は比較的多かったぜ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"生まれたときの第一声が「オギャー」だぜ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"最後に俺の自信作の漫画を紹介するぜ",expression:"C"},{speaker:"自信作の漫画",character:"mannga",expression:"A"},{speaker:"自信作の漫画",character:"mannga",expression:"B"},{speaker:"自信作の漫画",character:"mannga",expression:"C"},{speaker:"自信作の漫画",character:"mannga",expression:"D"},{speaker:"自信作の漫画",character:"mannga",expression:"E"},{speaker:"自信作の漫画",character:"mannga",expression:"F"}]},shigaku:{background:"test_1",bgm:"metoroido",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"昔さ、ライズっていうやば人の塾あったじゃん、今どんな感じ？",expression:"A"},{speaker:"かなと",character:"kanato",text:"どうもこうも、まだやってるよね？",expression:"B"},{speaker:"だいち",character:"daichi",text:"そうだね、その塾はまだやってる、今はライズ１とかいう名前でやってるけど",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"なついな、、、元気かな？",expression:"B"},{speaker:"かなと",character:"koutarou",text:"ああー、一日２箱のヘビースモーカーか",expression:"B"},{speaker:"なおき",character:"naoki",text:"いま、どうなってんだろね",expression:"C"},{speaker:"かなと",character:"kanato",text:"ちょっと、今度確認してくるわ",expression:"A"},{character:"narrator",text:"数日後",expression:"A"},{speaker:"やばじん",character:"yabajin",text:"おらぁぁぁ！！！！！",expression:"C"},{speaker:"やばじん",character:"yabajin",text:"おらぁぁぁ！！！！！",expression:"C"},{speaker:"なおき",character:"naoki",text:"でたな",expression:"B"},{speaker:"かなと",character:"kanato",text:"でたな",expression:"B"},{speaker:"かなと",character:"kanato",text:"なんか、安心したわ",expression:"B"},{speaker:"かなと",character:"kanato",text:"かわらない、良さというものがあるな",expression:"B"},{speaker:"なおき",character:"naoki",text:"ライズだなー",expression:"B"}]},team_shoyu_drinking:{background:"test_1",bgm:"nightbarth",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"お盆で暇だな、喜久でちょっと飲もうか",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"まぁ、ええよ、せっかくそろったしな",expression:"B"},{speaker:"かなと",character:"kanato",text:"えーと、ね、あの、うーん、えっとね",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"どした？？",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"？？",expression:"B"},{speaker:"かなと",character:"kanato",text:"おれら、実は喜久、出禁になったんよね、、",expression:"D"},{speaker:"ひろかず、こうたろう",character:"hirokazu",text:"！？",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"ん？どういうこと？",expression:"C"},{speaker:"ひろかず、こうたろう",character:"hirokazu",text:"まったく、おれら心当たりはないんだが？",expression:"C"},{speaker:"だいち",character:"daichi",text:"いや、説明すると、この前、「かなと、俺、なおき」その他のメンバーで飲みに行ったんやけど、",expression:"A"},{speaker:"だいち",character:"daichi",text:"その時に来た、日本酒のお酒の中になぜか日本酒と醤油が混ざってたんよ",expression:"B"},{speaker:"かなと",character:"kanato",text:"もちろん、俺らがいれたわけではないよ",expression:"B"},{speaker:"だいち",character:"daichi",text:"で、俺らもさすがに飲めないから、何もいわずにテーブルの上において帰ったんだけど",expression:"C"},{speaker:"だいち",character:"daichi",text:"それを、俺らがいたずらで入れたって話になって冤罪で出禁になりました。",expression:"D"},{speaker:"かなと",character:"kanato",text:"一応、次の日に謝りにいったけど門前払いを食らいました。",expression:"B"},{speaker:"かなと",character:"kanato",text:"ぶっちゃけ、俺ら何も悪いことしてないから何を反省していいのかわからんかったけど",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"俺とこうたろうはとばっちりすぎん？",expression:"B"},{speaker:"かなと",character:"kanato",text:"いや、、、、まぁ",expression:"C"},{speaker:"かなと",character:"kanato",text:"そう",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"なんでだよ、、",expression:"D"},{speaker:"こうたろう",character:"koutarou",text:"飛び火すぎるわ",expression:"E"},{speaker:"だいち",character:"daichi",text:"ｗｗｗｗｗｗｗｗｗｗｗ",expression:"F"},{speaker:"こうたろう",character:"koutarou",text:"どうすんだよ、、、どこでのむよ",expression:"G"},{speaker:"なおき",character:"naoki",text:"「かくれんぼ」、ならいけるとおもうぞ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"かくれんぼにするか、、、",expression:"B"},{speaker:"なおき",character:"naoki",text:"ちょうど、改装しているから行けるかどうか、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"まぁ、あそこはいけるやろ、あそこは、なんか知らんけどいつも空いてるやん",expression:"A"},{speaker:"なおき",character:"naoki",text:"たしかにぃ、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"えっと、どうする？",expression:"C"},{speaker:"かなと",character:"kanato",text:"何が？",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"もう、おれらのグループ名しょうゆにするか",expression:"A"},{speaker:"だいち",character:"daichi",text:"、、、するか、、、、醤油に",expression:"B"},{speaker:"かなと",character:"kanato",text:"じゃあ、ＬＩＮＥのグループ名は醤油にしときます",expression:"D"},{speaker:"こうたろう",character:"koutarou",text:"醤油か、、、、、おれは関係ないけど",expression:"C"},{speaker:"だいち",character:"daichi",text:"決定だ",expression:"A"},{character:"line_group_syouyu",text:"こうして、lineグループはしょうゆになった。",expression:"A"}]},seven:{background:"test_1",bgm:"Last_Summer_In_Rio",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"帰るか、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"どうやって帰ります？",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"ん？？そりゃ、タクシーで、、",expression:"C"},{speaker:"かなと",character:"kanato",text:"タクシー？",expression:"D"},{speaker:"なおき",character:"naoki",text:"三重町にそんな便利な物ないぞ",expression:"E"},{speaker:"だいち",character:"daichi",se:"dededon",text:"あっ！！！",expression:"F"},{speaker:"こうたろう",character:"koutarou",text:"三重町にはそんなものないぞ、こんな時間は",expression:"G"},{speaker:"なおき",character:"naoki",text:"残念だったなｗ",expression:"H"},{speaker:"ひろかず",character:"hirokazu",text:"歩いて帰るのか、、、",expression:"I"},{speaker:"だいち",character:"daichi",text:"三重町だからな、、、",expression:"J"},{speaker:"こうたろう",character:"koutarou",text:"仕方ないつきあってやるか",expression:"K"},{speaker:"かなと,なおき",character:"kanato",text:"はじまった、、反対方向なのに、、、",expression:"L"},{text:"移動中"},{speaker:"こうたろう",character:"koutarou",text:"、、、、、",expression:"N"},{speaker:"こうたろう",character:"koutarou",text:"、、、、、おれ結婚するんだよな、、、",expression:"N"},{speaker:"ひろかず",character:"hirokazu",text:"ん？？",expression:"O"},{speaker:"だいち",character:"daichi",text:"おっと、、、なんか言った？",expression:"P"},{speaker:"かなと",character:"kanato",text:"なんか、聞こえたな",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"おい、やっぱりおっぱいか、おっぱいなんだな、嫁さんおっぱい大きいって言ってたもんな！",expression:"Q"},{speaker:"こうたろう",character:"koutarou",text:"ん、、、、、？",expression:"R"},{speaker:"こうたろう",character:"koutarou",text:"そう",expression:"S"},{speaker:"なおき",character:"naoki",text:"おらぁぁぁ！！！！！！！！！！！！！！！！！！！！！！！！！！！！！",expression:"T"},{speaker:"ひろかず",character:"hirokazu",text:"えっと、どうする？処すか？",expression:"U"},{speaker:"だいち",character:"daichi",text:"処します",expression:"V"},{speaker:"かなと",character:"kanato",text:"拷問して、、、、死刑！！！！！！！！",expression:"W"},{speaker:"なおき",character:"naoki",text:"賛成です",expression:"X"},{speaker:"だいち",character:"daichi",text:"ゆるさんぞ！！！",expression:"Y"},{speaker:"ナレーション",character:"narrator",text:"ー２年後ー",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"おれ、結婚するんだよな、、、",expression:"Z"},{speaker:"かなと、なおき",character:"kanato",text:"はい、死刑",expression:"AA"}]},river_fire:{background:"test_1",bgm:"metoroido",conversations:[{speaker:"だいち少年",character:"daichi_young",text:"火遊びしたいな",expression:"A"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"これを使えば、火遊びできるよ",expression:"B"},{speaker:"だいち少年",character:"daichi_young",text:"よし！いけ！",expression:"C"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"いや、まてさすがにここでは周りに火が付きそうなものがおおい",expression:"B"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"なので、距離をおいて火をつけよう",expression:"B"},{speaker:"だいち少年",character:"daichi_young",text:"ここなら大丈夫だろ、この川の別れて、陸みたいになってるとこ！！！",expression:"C"},{speaker:"だいち少年",character:"daichi_young",text:"新大陸だ！！！！",expression:"C"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"ここならいける！！！！",expression:"B"},{speaker:"だいち少年",character:"daichi_young",text:"よし、やるんだ！！！",expression:"C"},{se:"bo",text:"ボッ！！"},{speaker:"ダイチ少年",character:"daichi_young",text:"火ついたな、、、",expression:"D"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"おおっ、、あたたけぇ、、、",expression:"B"},{speaker:"ダイチ少年",character:"daichi_young",text:"ええな、、、、",expression:"E"},{se:"byubyu",text:"びゅぅぅぅぅ、、、、"},{speaker:"ダイチ少年",character:"daichi_young",text:"なんか風が、、、なぁ、、、！？！？！！！！！？！？！？",expression:"E"},{speaker:"ダイチ少年",character:"daichi_young",text:"もえた、物が、、、、、風に飛んで、、",expression:"E"},{se:"bo",text:"ボッ！！"},{speaker:"ダイチ少年、ひろかず少年",character:"daichi_young",text:"あっっっ！！！！！！！！！！！！！！！！",expression:"E"},{speaker:"ダイチ少年",character:"daichi_young",text:"えっと、なんかやばくね",expression:"G"},{speaker:"ダイチ少年",character:"daichi_young",text:"やばくね？なんかやばくね？？？？？",expression:"G"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"、、、、、けせーーーーーーーー！、水かけろ！！！！",expression:"H"},{speaker:"ダイチ少年",character:"daichi_young",text:"まずいまずいまずいまずいまずいまずいまずいまずい！！！！！！！",expression:"I"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"みっ、、、水をかけるんだ！！！はやく！！！！",expression:"J"},{speaker:"ダイチ少年",character:"daichi_young",text:"ダメだ！！！！！火の勢いが強い",expression:"K"},{speaker:"ひろかず少年",character:"daichi_young",text:"つっっつち！！！！土をなげろぉーーーーーーーーーー！！！！！",expression:"K"},{speaker:"ダイチ少年",character:"daichi_young",text:"泥しかないです！！！",expression:"K"},{speaker:"ダイチ少年",character:"daichi_young",text:"いいから、なげろぉぉおぉ！！！",expression:"K"},{speaker:"ダイチ少年",character:"daichi_young",text:"火がぁぁぁ！つよい！！！",expression:"K"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"あきらめるな！！！早くけせーーーーーーーー！！！",expression:"L"},{text:"３０分後",expression:"A"},{speaker:"ダイチ少年",character:"daichi_young",text:"やったか？、、、",expression:"M"},{se:"bo",text:"ボッ！！"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"早くけせーーーーーーーー！！！",expression:"L"},{text:"３０分後",expression:"A"},{speaker:"ダイチ少年",character:"daichi_young",text:"なっ、、、何とかきえたぞ、、、、",expression:"M"},{speaker:"ひろかず少年",character:"hirokazu_young",text:"やばかった、焦ったわ、、、、、",expression:"N"}]},koutarou_potato:{background:"test_1",bgm:"Nagisa_Moderato",conversations:[{speaker:"だいち",character:"daichi",text:"ここのポテトうまいな、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ここは三重町で有名なポテト屋ですよ",expression:"B"},{speaker:"だいち",character:"daichi",text:"１００円で、この量はお得でうまいな",expression:"C"},{speaker:"だいち",character:"daichi",text:"まぁ、いいけど、一週間ずっと、来てるやん、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"うまいからいいんだよ",expression:"B"},{speaker:"だいち",character:"daichi",text:"あっ、、、はい",expression:"C"}]},antares:{background:"test_1",bgm:"Nagisa_Moderato",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"バス釣りっておもしろいな、、、リールがほしい、、、",expression:"A"},{speaker:"だいち",character:"daichi",text:"やっぱ、釣り道具ってかっちょいいよな",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"アンタレス欲しいな、、、あと、ルアーも",expression:"C"},{speaker:"だいち",character:"daichi",text:"とりあえず、帰りにバス釣り行くぞ！！",expression:"D"},{speaker:"ひろかず",character:"hirokazu",text:"おっしゃ、いくんだ！！！",expression:"E"},{speaker:"ひろかず",character:"hirokazu",text:"おらぁぁぁ！！！！！",expression:"F"},{speaker:"ひろかず",character:"hirokazu",text:"ああああああああ、俺のルアーがあああああああ",expression:"G"},{speaker:"ひろかず",character:"hirokazu",text:"ルアーだけ飛んでったぞ、、、、、、うわぁぁぁ",expression:"H"}]},drink_zutsu:{background:"test_1",bgm:"nightbarth",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"普通の酒飲み飽きたなー",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"ドンキで探すか",expression:"A"},{speaker:"だいち",character:"daichi",text:"あっ！これよくね！？",expression:"B"},{character:"dutu",se:"donn"},{speaker:"ひろかず",character:"hirokazu",text:"これもう一気するための大きさじゃん！",expression:"B"},{speaker:"だいち",character:"daichi",text:"一気してくださいって言ってるなあ！",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"それ御神酒じゃね？",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"ドンキには一気する用の酒も売ってるんかあ！",expression:"B"},{speaker:"だいち",character:"daichi",text:"じゃあ1人一本ずつ買うか！",expression:"A"},{speaker:"こうたろう",character:"koutarou",text:"いや1人一本ずつのやつかそれ？",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:'1人一本"ずつ"のやつ、いくぞお！',expression:"B"},{speaker:"だいち",character:"daichi",text:'"ずつ"！うおおお！',expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"だから……まあいいか！うおおお！",expression:"A"},{text:"、、、夜、、、"},{speaker:"ひろかず",character:"hirokazu",text:"ーーさて、夜も更けてきました",expression:"A"},{speaker:"だいち",character:"daichi",text:'"ずつ"、いきますか',expression:"A"},{speaker:"こうたろう",character:"koutarou",text:'もうそれの名前"ずつ"なんや',expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"よっしゃ3人で同時にいくぞお！",expression:"B"},{speaker:"だいち",character:"daichi",text:"うおおお！",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"もういいや！いくぞお！",expression:"A"},{speaker:"ひろかず・だいち・こうたろう",character:"all",text:"「「「ゴクゴクゴッ…オロロロロロ✨」」」",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"なんだこれ…",expression:"C"},{speaker:"だいち",character:"daichi",text:"体に入らないです",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"胃に当たってそのまま跳ね返ってくる",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"オロロロロロ✨",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"オロロロロロ…",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"止まらん…",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"木の下に吐こオロロロロロ✨",expression:"C"},{speaker:"だいち",character:"daichi",text:"大きく成長しろよ",expression:"C"},{speaker:"だいち",character:"daichi",text:"オロロロロロ✨",expression:"C"},{speaker:"こうたろう",character:"koutarou",text:"最低の栄養や…",expression:"C"}]},snack_street_night:{background:"test_1",bgm:"nightbarth",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"あー飲んだなー",expression:"A"},{speaker:"かなと",character:"kanato",text:"まだ21時か……",expression:"B"},{speaker:"こうたろう",character:"koutarou",text:"2軒目いくか",expression:"A"},{speaker:"なおき",character:"naoki",text:"空いてるのスナックしかないよなー",expression:"B"},{speaker:"だいち",character:"daichi",text:"三重町はこの時間もう眠ってるからな",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"よし、じゃあスナック行くぞ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"ここは三重町駅前。推定平均年齢50歳、無数のママたちがひしめく三重町最大の歓楽街。",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"【スナック名鑑 in 三重町】",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"まずはここ！！『シリウス』クセの強い「よいしょ⤴あそれ⤴」のカラオケ合いの手が名物！文字では伝わらないニュアンス！あともう店は潰れてるぞ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"『シリウス』！！！！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"クセの強い「よいしょ⤴あっそれ⤴」のカラオケ合いの手が名物！文字では伝わらないニュアンス！あともう店は潰れてるぞ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"次に、『ジュエリー』鳴物入りでやってきたルーキー！原液9割のレモンサワーで飛べるぞ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"更に『ドール』唯一の同世代・アイドルまゆちゃん！三重町最後の希望だ！でももう引退したぞ！あと同級生の親とかも通ってる！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"『シークレット』カラオケが盛り上がりすぎて会話できない！最高なフィリピンママによるネイティブ洋楽とフィリピン料理が魅力！料金はちょっと不安になるくらい安いぞ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"『花市場』『ジョエリン』『さくら』『クール』他にも愉快なスナックが勢揃いだ！",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"4時間後",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"やっぱスナックのあとに、コンビニで3次会するのが最高なんだよな〜",expression:"A"},{speaker:"ナレーター",character:"narrator",text:"三重町の夜は、まだまだ寝かせてくれない。",expression:"A"}]},annex_momo:{background:"test_1",bgm:"togetogetarumeiro",conversations:[{character:"narrator",text:"ここに、二匹の狼がいた。",expression:"A"},{character:"narrator",text:"賢い狼と、気のいい狼。二匹は共に狩りや水浴びをするほど仲がよかった。",expression:"A"},{character:"narrator",text:"あるとき、賢い狼が言った。",expression:"A"},{character:"narrator",text:"「獲物を追いかけるより、待ち伏せをしよう。そうすれば遠くまで出かけずとも、獲物のほうからやって来るだろう」",expression:"A"},{character:"narrator",text:"気のいい狼は二つ返事でうなずいた。だが、二匹には待ち伏せに適した場所の心当たりがなかった。",expression:"A"},{character:"narrator",text:"そこで二匹は、村の物知りな狼に相談することにした。",expression:"A"},{character:"narrator",text:"物知りな狼は言った。",expression:"A"},{character:"narrator",text:"「知りたければ、対価を払いなさい」",expression:"A"},{character:"narrator",text:"二匹はしぶしぶ、以前に狩った獲物を物知りな狼に分け与えた。",expression:"A"},{character:"narrator",text:"満足そうにうなずいた物知りな狼は答えた。",expression:"A"},{character:"narrator",text:"「村の外れに、使われていない洞窟が二か所ある。人目につきにくく、狩りには最適だ」",expression:"A"},{character:"narrator",text:"「そこは自然も豊かで、獲物も多く、丸々太ってうまそうに見える」とも。",expression:"A"},{character:"narrator",text:"物知りな狼は続けた。",expression:"A"},{character:"narrator",text:"「ただし、そこから帰るには“対価”が必要だ。その対価はわしにも分からん」",expression:"A"},{character:"narrator",text:"少しの疑念を抱きながらも、二匹の狼は洞窟へ向かった。",expression:"A"},{character:"narrator",text:"日が沈み、夜が更けるころ、二つの気配が近づいてきた。",expression:"A"},{character:"narrator",text:"夜闇にまぎれて獲物の全貌は見えない。それでも二匹は息を潜め、洞窟で待ち伏せを続けた。",expression:"A"},{character:"narrator",text:"やがて、二匹の獲物が洞窟に入る。",expression:"A"},{character:"narrator",text:"その瞬間、二匹の狼は獲物をとらえるため、行動を起こした",expression:"A"},{character:"narrator",text:"しかし、２匹の狼は行動を停止した。狩りの本能も急止した。",expression:"A"},{character:"narrator",text:"理由は簡単だった、目の前の獲物が、たいそう好みではなかったのだ。端的に言えば——マズそう、だった。",expression:"A"},{character:"narrator",text:"それでも二匹は引けなかった。ここに至るまでに、物知りな狼に対価を払ってしまっていたからだ。",expression:"A"},{character:"narrator",text:"何も、しないで帰ることは、二匹のプライドが許さなかった。",expression:"A"},{character:"narrator",text:"——狩りは終わった。昇る朝日を背に、肩を落とした帰り道に、ぽつりと気のいい狼が言葉をこぼした。",expression:"A"},{character:"narrator",text:"「あの日、僕らは大人になった」",expression:"A"},{character:"narrator",text:"賢い狼は、それを苦い顔で聞き流した。",expression:"A"}]},okagami_conversation:{background:"test_1",bgm:"Fantasy",conversations:[{speaker:"おかがみ",character:"okagami",text:"タバコが切れた...",expression:"C"},{speaker:"おかがみ",character:"okagami",text:"集合！！",expression:"A"},{speaker:"おかがみ",character:"okagami",text:"釘宮！お前はまじでダメ！やる気が足りない！サボるな！",expression:"A"},{speaker:"おかがみ",character:"okagami",text:"河室！なんだその髪の毛は桜木花道じゃねえか！",expression:"A"},{speaker:"おかがみ",character:"okagami",text:"ボコっ！ (殴る音)",expression:"A"},{speaker:"自分",character:"player",text:"俺らの時代だからまだ許されてる感あるよな....",expression:"C"},{speaker:"自分",character:"player",text:"まじで痛えな...",expression:"C"}]},daichi_conversation:{background:"test_1",bgm:"Fantasy",conversations:[{speaker:"だいち",character:"daichi",text:"副リーダーとかいうの嫌すぎるな",expression:"C"},{speaker:"だいち",character:"daichi",text:"どっかでサボろうぜ",expression:"A"},{speaker:"だいち",character:"daichi",text:"またおかがみに怒られるだけかもだけど...",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"だいちはいっつも冷めてるよな",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"まあ、いいやチョロQ持ってきてるからこれで遊ぶぞ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"それか、このバス釣りの雑誌みんなで見ようぜ",expression:"A"},{speaker:"だいち",character:"daichi",text:"いつもの流れだけど、これが一番楽しいよな笑",expression:"A"}]}},z={computer:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"ここはコンピュータエリアだぜ☆",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"最新のテクノロジーが集まってる場所だな",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"プログラミングとか、AIとか、いろんな技術があるぜ",expression:"A"}]},breaking_car:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"故障した車があるな...",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"メンテナンスが必要だな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"安全第一で修理しないとな",expression:"C"}]},special_scam:{background:"test_1",bgm:"togetogetarumeiroo",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"友達の結婚式よかったな、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"とりあえず、ネカフェに泊まって体、バキバキだから一服するか",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"ふぅ、、、、、、",expression:"C"},{speaker:"知らないおじさん",character:"stranger",text:"ちょっと、お兄さん、ここらへんで有名な居酒屋しらない？",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"俺も、、、久しぶりにかえったからな、、、とりあえず、知っているところ答えるか",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ここなんかはゆうめいですね、、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ありがとうありがとう、、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"お兄さんいい人だから、俺もいろいろ話したくなったわ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"実は俺宝くじ当たったから、働く必要なくなって鹿児島観光してたんだわ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"お兄さんいつ帰るの？あした？",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"じゃあもう飛行機とかいいから、ちょっと話そうよ、飯いこう",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"焼き鳥とかにいこうや",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ん？？？？言ったところと違うけど、まぁええか",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、わかりました",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"焼き鳥おいしいですね",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"美味しかったですね。",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ちょっと、つかれましたね、そこのベンチに座りましょう",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"仕事とかあんまりうまくいってなくて、さらに家族もいろいろあって",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"彼女とも大変で、そのうえ生活費出すのギリギリで、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"うぅ、、、、くぅ、、、、",expression:"C"},{speaker:"知らないおじさん",character:"stranger",text:"そっか、大変やったんやな",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"そうだな、、俺、宝くじ１億円当たってるし、５０万あげるわ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"マジっすか",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"じゃあ、もう今日はゆっくり帰りな",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"今日はもう飛行機キャンセルして、きれいなおねーちゃんがいるところといいとこ連れて行ってあげるよ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"だけど、そうだな、このまま５０万円上げるのは簡単だけど",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"お兄さんの今後のためにそのまま渡すだけでは意味ないな、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"お兄さんならどうする？",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ど、、どうすかね、、、",expression:"B"},{speaker:"知らないおじさん",character:"stranger",text:"こうするのがいいよ、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"俺今、金を扱う仕事をしていて、金を扱うトレーダーをしているんだ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"日本で買って、海外っていうか中国とかで売るって感じかな",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"中国では金の価値がめっちゃあがっているんだよ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"で、今、ちょうど一口あいてて",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"確定で５０万とか入れたら１倍以上、、、２倍とかになるから",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"その一口をあげるよ",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ただし、その５０万円は自分で準備してね、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"どうする？？",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"、、、うっ、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"状況を整理しよう、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"俺は（2022年）当時、貯金ゼロ、友達の祝儀３万とかでカツカツ、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"しかも、今ニート、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"だが、お金は欲しい、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"でも、お金を増やすにはお金がいる",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"、、、どうしよう、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"借りるしかないよな、、、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"借りるしか、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"ちょっと、待ってください",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"俺今、カツカツなので、消費者金融をあたらせてください",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ニートでも行ける消費者金融を探すか、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"なかなか、ないか、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"あった、ここだ、、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、５０万、、、借りました",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"よし、じゃあ、今から連れて行くところに金があるんよね",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"そこで買って、郵便とか全部俺がして届けるから、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"そのあと一緒に、今日ご飯とか食べたり、お酒飲んだりいろいろ一緒にしよう",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"で、、、、場所なんだけど、ドン・キホーテ、、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ドン・キホーテに金が売っているから、とりあえず、先に口座でお金おろしてきてね",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"わかりました、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"ガラガラ、、、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"５０万円の札束、、うわ、、、これが５０万なんだ、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"これが５０万円なんすね、すごいっすね",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"いや、もっと増えるから",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"こんなもんじゃないよ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"うわ、マジっすか、、",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"とりあえず、この場でパッと渡すと怪しまれるから",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ちょっと、そこの通りを歩いて、人目のつかない場所に行こうか",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"じゃあ、これよろしくお願いしますね",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"じゃあ、ドン・キホーテに行こうか",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"ドン・キホーテについたけど、俺金を買ってくるからちょっとここでまっててね",expression:"A"},{speaker:"知らないおじさん",character:"stranger",text:"絶対まっててよ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"わかりました！！！",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"数分後、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"もうそろそろかな、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"数十分後、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"まぁまぁまぁまぁ、、、金に換えるからなこれぐらいかかるんだろな",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"まぁ、いい人だったしな、、、、まぁ。。ないよな、、、そんなこと、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"３０分後、、、",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、、あへぇ、、あれ、、、おかしいな、、、、おそいな、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"んん、、、あれ、、、あへぇぇ、、ほんとに、、、おそいな、、、おそ、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"あっ、、、、、あっあっ、、、ア、、、、いや、、、あっ、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"、、、、あっ、騙された、、、、、、、、、、、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"はっ、っは、、、、はぁ、はぁ、うぅ、、、、、はぁ、はぁ、、、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"あああああ、、、、、あああああああああああ、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"とっ、とりあえず、ちょっと、顔見知りの居酒屋のオーナーにそっ、相談しよう",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"プルルルルルル",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"、、、、、あああああ、、だっ、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"騙されました、どうしましょう、、",expression:"C"},{speaker:"親切な居酒屋の店主",character:"owner",text:"落ち着け、とりあえず、交番にいきーーー",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"、、、、、、、",expression:"C"},{speaker:"交番",character:"police",text:"どうされました？？",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"うっ、、、うぅ、、、騙されました。。。。",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"５０万をかりでぇ、、、そして、ドンキでお金渡して、、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"うぅ、、、うっ、、、、、",expression:"C"},{speaker:"交番",character:"police",text:"証拠はありますでしょうか、、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"なっ、、ないです、、、、、",expression:"C"},{speaker:"交番",character:"police",text:"その人は、、どんな顔だった？？？",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"えっ、、絵は得意なので、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"うぅ、、かっ、、描きます、、、、",expression:"C"},{speaker:"交番",character:"police",text:"、、、、、、",expression:"A"},{speaker:"交番",character:"police",text:"、、、、、、、、、",expression:"A"},{speaker:"交番",character:"police",text:"一応、これで捜査してみますが、、、",expression:"A"},{speaker:"交番",character:"police",text:"、、、こりゃ、、、見つかりはせんで、、、、",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"、、、、、しばらくして、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"その５０万円は帰ってくることはなかった、、、",expression:"C"},{speaker:"ひろかず",character:"hirokazu",text:"ひろかずは目の前が真っ暗になった",expression:"C"}]},rojyounopenki:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"路上の噴水だな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"街の景観を良くしてるぜ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"夏は涼しそうだな",expression:"A"}]},tereapo:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"テレビ塔だ！",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"電波を送信してる重要な施設だな",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"街のランドマークになってるぜ☆",expression:"A"}]},first_rising_sun:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"初日の出を見る場所だな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"新年の始まりを祝う場所だぜ",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"みんなで集まってお祝いするんだな",expression:"A"}]},arechi:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"ここは荒地だな...",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"開発が進んでいない場所だぜ",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"将来は何か建つかもしれないな",expression:"C"}]},gray_bytes:{background:"test_1",bgm:"curono",conversations:[{speaker:"ひろかず",character:"hirokazu",text:"グレーバイト...",expression:"B"},{speaker:"ひろかず",character:"hirokazu",text:"何か秘密がありそうだな",expression:"A"},{speaker:"ひろかず",character:"hirokazu",text:"調査してみるか？",expression:"C"}]}};class B{constructor(e){this.scene=e,this.areas=[],this.areaSprites=[],this.selectedArea=null,this.isInteractive=!0,this.hoverEffect=null,this.isMobile=this.scene.sys.game.device.input.touch,this.touchStartTime=0,this.touchThreshold=200,this.visualFeedback=new o(e),this.isConfirmDialogActive=!1,this.currentDialog=null}setupAreas(e){this.destroy(),e&&Array.isArray(e)?this.areas=e.map((e=>({...e,description:this.getAreaDescription(e.name)}))):this.areas=[],this.areas.forEach((e=>{if(e){const t=this.createAreaMarker(e);t&&this.areaSprites.push(t)}})),this.setupInteractionEvents()}getAreaDescription(e){return{Trial:"トライアル",Flash_land_mie:"フラッシュランド三重",oreno_koto:"俺のこと",momoiro_jyogakuenn:"２匹の狼と獲物",drinking_dutu:"づつ",Weeds_burn:"雑草がもえるぅぅ",mie_high_school:"三重中学校",raizu:"ライズ",snack_street_night:"三重町の歓楽街",souce:"ソース",koutaroupoteto:"こうたろうポテト",seven:"セブン",taketa_station:"竹田駅",taketa_high_school:"竹田高校",galaxy_water:"銀河の水",udefuriojisann:"ウデフリオジサン",working_go_to_home_miemachi:"飲み会後三重町まで歩く",computer:"エンジニア",breaking_car:"BMW",special_scam:"あやしいおじさん",rojyounopenki:"路上のペンキ",tereapo:"テレアポ",first_rising_sun:"初日の出",arechi:"荒地",gray_bytes:"グレーバイト"}[e]||e}createAreaMarkers(){this.areaSprites=[],this.areas&&0!==this.areas.length&&this.areas.forEach((e=>{if(e){const t=this.createAreaMarker(e);t&&this.areaSprites.push(t)}}))}createAreaMarker(e){const t=this.scene.add.container(0,0);t.setData("markerType","areaMarker"),t.setData("areaName",e.name);const a=this.scene.mapManager?.mapScaleX||1,s=Math.max(10,Math.floor(10*a))+"px",r=Math.max(15,15*a),i=e.width||100,n=e.height||100,o=e.x,c=e.y,h=e.ellipse||!1,p=e.rotation||0,l=o+i/2,u=c+n/2;let g,d=l,x=u;if(0!==p){const e=p*Math.PI/180,t=l-o,a=u-c;d=o+(t*Math.cos(e)-a*Math.sin(e)),x=c+(t*Math.sin(e)+a*Math.cos(e))}g=h?this.scene.add.ellipse(d,x,i,n,4286945,.1):this.scene.add.rectangle(d,x,i,n,4286945,.1),g.setData("markerType","areaMarker"),g.setData("areaName",e.name),g.setOrigin(.5,.5),0!==p&&g.setRotation(p*Math.PI/180),this.scene.tweens.add({targets:g,alpha:.3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const k=this.scene.add.text(o+i/2,c-r,e.description,{fontSize:s,fill:"#000000",backgroundColor:"#FFFFFF",padding:{x:3*a,y:1*a},borderRadius:2*a});return k.setOrigin(.5,.5),k.setData("markerType","areaMarker"),k.setData("areaName",e.name),t.add(g),t.add(k),g.setInteractive(),g.setData("area",e),this.setupMarkerHover(g,k),this.setupMarkerClick(g),t}setupMarkerHover(e,t){e.on("pointerover",(()=>{this.isMobile||(this.visualFeedback.showButtonHover(e,1.2,16766720,.3),t.setStyle({fill:"#FF0000"}))})),e.on("pointerout",(()=>{this.isMobile||(this.visualFeedback.resetButtonState(e,1,4286945,.1),t.setStyle({fill:"#000000"}))}))}setupMarkerClick(e){e.on("pointerdown",(()=>{if(this.isConfirmDialogActive)return;this.isMobile&&(this.touchStartTime=Date.now()),this.resetAllObjectColors(),e.setFillStyle(16711680,.7);const t=e.getData("area"),a=t.x+(t.width||100)/2,s=t.y+(t.height||100)/2;this.visualFeedback.showObjectRipple(a,s,t.width||100,t.height||100,16711680)})),e.on("pointerup",(()=>{if(this.isConfirmDialogActive)return;const t=e.getData("area");this.isMobile?Date.now()-this.touchStartTime<this.touchThreshold&&this.selectArea(t):this.selectArea(t)}))}setupInteractionEvents(){this.scene.input.on("pointerdown",(e=>{this.lastTapX=e.x,this.lastTapY=e.y})),this.scene.input.on("pointerup",(e=>{Math.abs(e.x-this.lastTapX),Math.abs(e.y-this.lastTapY)}))}selectArea(e){try{if(!this.isInteractive)return;if(this.isConfirmDialogActive)return;this.selectedArea=e,this.showSelectionEffect(e),this.playSelectionSound()}catch(e){}}showSelectionEffect(e){this.showConfirmDialog(e)}resetAllObjectColors(){this.areaSprites.forEach((e=>{const t=e.getAt(0);t&&t.setFillStyle&&t.setFillStyle(4286945,.1)}))}resetSelectedObjectColor(){this.selectedArea&&this.areaSprites.forEach((e=>{const t=e.getAt(0);if(t&&t.setFillStyle){const e=t.getData("area");e&&e.name===this.selectedArea.name&&t.setFillStyle(4286945,.1)}}))}showConfirmDialog(e){if(this.isConfirmDialogActive)return;this.isConfirmDialogActive=!0;const t=this.scene.add.container(this.scene.cameras.main.worldView.centerX,this.scene.cameras.main.worldView.centerY);this.currentDialog=t;const a=this.scene.add.rectangle(0,0,300,150,0,.8);a.setStrokeStyle(2,16777215);const s=this.scene.add.text(0,-40,e.description,{fontSize:"18px",fill:"#FFFFFF",align:"center"});s.setOrigin(.5);const r=this.scene.add.text(0,-10,"この場所に移動しますか？",{fontSize:"14px",fill:"#FFFFFF",align:"center"});r.setOrigin(.5);const i=this.scene.add.text(-60,30,"はい",{fontSize:"16px",fill:"#00FF00",backgroundColor:"#333333",padding:{x:10,y:5}});i.setOrigin(.5),i.setInteractive();const n=this.scene.add.text(60,30,"いいえ",{fontSize:"16px",fill:"#FF0000",backgroundColor:"#333333",padding:{x:10,y:5}});n.setOrigin(.5),n.setInteractive(),t.add([a,s,r,i,n]);const o=()=>{t.active&&t.destroy(),this.isConfirmDialogActive=!1,this.currentDialog=null,this.resetSelectedObjectColor()};i.on("pointerdown",(()=>{o(),this.handleAreaSelection(e)})),n.on("pointerdown",(()=>{o()})),this.scene.time.delayedCall(5e3,(()=>{t.active&&o()}))}handleAreaSelection(e){this.scene.mapConfig&&"taketa_city"===this.scene.mapConfig.mapKey?this.handleTaketaConversation(e):this.scene.mapConfig&&"bunngo_mie_city"===this.scene.mapConfig.mapKey?this.handleMiemachiConversation(e):this.scene.mapConfig&&"japan"===this.scene.mapConfig.mapKey?this.handleJapanConversation(e):this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}handleTaketaConversation(e){let t=null;if(e.conversationId&&null!==e.conversationId)t=e.conversationId;else switch(e.name){case"taketa_station":t="taketa_station";break;case"galaxy_water":t="ginnga_water";break;case"udefuriojisann":t="arm_swinging_person";break;case"working_go_to_home_miemachi":t="working_go_to_home_miemachi";break;default:return void this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}const a=this.scene.mapConfig?.mapKey||"unknown",s=this.getConversationData(a,t);s?this.scene.conversationTrigger?this.scene.conversationTrigger.startVisualNovelConversation(s):console.log("[ERROR] conversationTrigger が存在しません"):this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}handleJapanConversation(e){let t=null;if(e.conversationId&&null!==e.conversationId)t=e.conversationId;else switch(e.name){case"computer":t="computer";break;case"breaking_car":t="breaking_car";break;case"special_scam":t="special_scam";break;case"rojyounopenki":t="rojyounopenki";break;case"tereapo":t="tereapo";break;case"first_rising_sun":t="first_rising_sun";break;case"arechi":t="arechi";break;default:return void this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}const a=this.scene.mapConfig?.mapKey||"unknown",s=this.getConversationData(a,t);s?this.scene.conversationTrigger?this.scene.conversationTrigger.startVisualNovelConversation(s):console.log("[ERROR] conversationTrigger が存在しません"):this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}handleMiemachiConversation(e){let t=null;if(e.conversationId&&null!==e.conversationId)t=e.conversationId;else switch(e.name){case"oreno_koto":t="oreno_koto";break;case"raizu":t="shigaku";break;case"souce":t="team_shoyu_drinking";break;case"Weeds_burn":t="river_fire";break;case"koutaroupoteto":t="koutarou_potato";break;case"drinking_dutu":t="drink_zutsu";break;case"snack_street_night":t="snack_street_night";break;case"momoiro_jyogakuenn":t="annex_momo";break;case"Flash_land_mie":t="flash_land_mie";break;default:return void this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}const a=this.scene.mapConfig?.mapKey||"unknown",s=this.getConversationData(a,t);s?this.scene.conversationTrigger&&this.scene.conversationTrigger.startVisualNovelConversation(s):this.scene.time.delayedCall(1e3,(()=>{this.navigateToArea(e)}))}getConversationData(e,t){let a;switch(e){case"bunngo_mie_city":a=w[t];break;case"taketa_city":a=S[t];break;case"japan":a=z[t];break;default:a=w[t]||S[t]||z[t]}return a}navigateToArea(e){if(!e.sceneParam&&e.name){const t=this.scene.mapConfig?.areas?.find((t=>t.name===e.name));t&&(e.sceneParam=t.sceneParam,e.scene=t.scene)}if(e.scene)if("startPhaserGame"===e.scene){const t=this.scene.mapConfig?.mapKey||"unknown",s=e.sceneParam||1;window.returnToMap=()=>{window.game&&window.game.scene&&window.game.scene.scenes.forEach((e=>{e&&e.scene&&(e.scene.isActive()&&e.scene.stop(),e.scene.remove())})),window.game&&(window.game.destroy(!0),window.game=null),window.gameInstance&&(window.gameInstance=null),Promise.resolve().then(a.bind(a,355)).then((({startPhaserGame:e})=>{e(t)}))},this.scene.scene.get("ConversationScene")&&this.scene.scene.remove("ConversationScene"),this.scene.scene.stop(),Promise.resolve().then(a.bind(a,355)).then((({startPhaserGame:e})=>{e(s)}))}else Promise.resolve().then(a.bind(a,355)).then((({startPhaserGame:t})=>{t(e.scene)}))}playSelectionSound(){try{this.scene.audioManager&&this.scene.audioManager.playSe("se_touch",.5)}catch(e){}}enableInteraction(){this.isInteractive=!0}disableInteraction(){this.isInteractive=!1}update(){}handleTouchAt(e,t){try{const a=this.findAreaAtPosition(e,t);a?this.selectArea(a):this.scene.audioManager&&this.scene.mapConfig?.se?.map_touch&&this.scene.audioManager.playSe("se_map_touch",.3)}catch(e){console.error("AreaSelectionManager: Error in handleTouchAt:",e)}}findAreaAtPosition(e,t){const a=20*(this.scene.mapManager?.mapScaleX||1);for(let s of this.areas)if(Math.sqrt(Math.pow(e-s.x,2)+Math.pow(t-s.y,2))<=a)return s;return null}getAreas(){return this.areas}findAreaByName(e){return this.areas.find((t=>t.name===e))}updateAreaPositions(e){e&&0!==e.length?(this.destroy(),this.scene&&this.scene.children&&this.scene.children.entries&&this.scene.children.entries.forEach((e=>{!e||"Container"!==e.type&&"Arc"!==e.type&&"Text"!==e.type||e.destroy&&e.destroy()})),this.areas=e.map((e=>{const t=this.areas.find((t=>t.name===e.name));let a=t?.sceneParam,s=t?.scene,r=t?.conversationId;if(!a||!s){const t=this.scene.mapConfig?.areas?.find((t=>t.name===e.name));t&&(a=t.sceneParam,s=t.scene,r=t.conversationId)}return{...e,sceneParam:a,scene:s,conversationId:r,description:this.getAreaDescription(e.name)}})),this.createAreaMarkers()):console.warn("AreaSelectionManager: No areas provided for marker update")}repositionMarkers(){const e=this.scene.mapManager?.mapScaleX||1,t=15*e;this.areaSprites.forEach(((a,s)=>{if(a&&this.areas[s]){const r=this.areas[s];a.children.entries.forEach((a=>{if("Arc"===a.type)a.setPosition(r.x,r.y),a.setRadius(10*e),a.setStrokeStyle(2*e,16777215);else if("Text"===a.type){a.setPosition(r.x,r.y-t);const s=Math.max(8,Math.floor(10*e))+"px";a.setStyle({fontSize:s})}}))}}))}destroy(){this.currentDialog&&this.currentDialog.active&&this.currentDialog.destroy(),this.isConfirmDialogActive=!1,this.currentDialog=null,this.areaSprites&&Array.isArray(this.areaSprites)&&this.areaSprites.forEach((e=>{e&&(e.children&&e.children.entries&&e.children.entries.forEach((e=>{e&&e.destroy&&e.destroy()})),e.destroy&&e.destroy())})),this.scene&&this.scene.children&&this.scene.children.entries&&this.scene.children.entries.forEach((e=>{e&&e.getData&&"areaMarker"===e.getData("markerType")&&e.destroy&&e.destroy()})),this.scene&&this.scene.children&&this.scene.children.entries&&this.scene.children.entries.forEach((e=>{e&&"Container"===e.type&&e.each((e=>{e&&e.getData&&"areaMarker"===e.getData("markerType")&&e.destroy&&e.destroy()}))})),this.areaSprites=[],this.selectedArea=null}}const T={select_screen:{bgm:{menu:"assets/audio/bgm/zelda_menu_select.mp3"},se:{touch:"assets/audio/se/touch_1.mp3"}},stage_select:{bgm:{menu:"assets/audio/bgm/zelda_menu_select.mp3"},se:{touch:"assets/audio/se/touch_1.mp3"}},miemachi:{mapKey:"bunngo_mie_city",tilesetKey:"miemachi",mapTitle:"三重町マップ",bgm:{map:"assets/audio/bgm/kessen_diaruga.mp3",curono:"assets/audio/bgm/curono.mp3",Fantasy:"assets/audio/bgm/Fantasy.mp3",Jounetsu_Tairiku:"assets/audio/bgm/Jounetsu_Tairiku.mp3",Last_Summer_In_Rio:"assets/audio/bgm/Last_Summer_In_Rio.mp3",metoroido:"assets/audio/bgm/metoroido.mp3",Nagisa_Moderato:"assets/audio/bgm/Nagisa_Moderato.mp3",nightbarth:"assets/audio/bgm/nightbarth.mp3",ON_THE_BEACH:"assets/audio/bgm/ON_THE_BEACH.mp3",togetogetarumeiro:"assets/audio/bgm/togetogetarumeiro.mp3"},se:{touch:"assets/audio/se/touch_7.mp3",map_touch:"assets/audio/se/touch_2.mp3"},characters:{hirokazu_A:"assets/characters/portraits/hirokazu_A.png",hirokazu_B:"assets/characters/portraits/hirokazu_B.png",hirokazu_C:"assets/characters/portraits/hirokazu_C.png",hirokazu_D:"assets/characters/portraits/hirokazu_D.png",hirokazu_E:"assets/characters/portraits/hirokazu_E.png",hirokazu_F:"assets/characters/portraits/hirokazu_F.png",daichi_A:"assets/characters/portraits/daichi_A.png",naoki_A:"assets/characters/portraits/naoki_A.png",kanato_A:"assets/characters/portraits/kanato_A.png",kanato_B:"assets/characters/portraits/kanato_B.png",koutarou_A:"assets/characters/portraits/koutarou_A.png",koutarou_B:"assets/characters/portraits/koutarou_B.png"},backgrounds:{test_1:"assets/backgrounds/background_test.png"},areas:[{name:"oreno_koto",scene:null,conversationId:"oreno_koto"},{name:"momoiro_jyogakuenn",scene:null,conversationId:"annex_momo"},{name:"drinking_dutu",scene:null,conversationId:"drink_zutsu"},{name:"Weeds_burn",scene:null,conversationId:"river_fire"},{name:"mie_high_school",scene:"startPhaserGame",sceneParam:1,conversationId:null},{name:"raizu",scene:null,conversationId:"shigaku"},{name:"snack_street_night",scene:null,conversationId:"snack_street_night"},{name:"souce",scene:null,conversationId:"team_shoyu_drinking"},{name:"koutaroupoteto",scene:null,conversationId:"koutarou_potato"},{name:"seven",scene:null,conversationId:"seven"}]},taketastage:{mapKey:"taketa_city",tilesetKey:"taketa_map",mapTitle:"竹田ステージ",bgm:{map:"assets/audio/bgm/Spain.mp3",Fantasy:"assets/audio/bgm/Fantasy.mp3",Nagisa_Moderato:"assets/audio/bgm/Nagisa_Moderato.mp3",nightbarth:"assets/audio/bgm/nightbarth.mp3",The_Terminator:"assets/audio/bgm/The_Terminator.mp3"},se:{touch:"assets/audio/se/touch_7.mp3",map_touch:"assets/audio/se/touch_2.mp3"},characters:{hirokazu_A:"assets/characters/portraits/hirokazu_A.png",hirokazu_B:"assets/characters/portraits/hirokazu_B.png",hirokazu_C:"assets/characters/portraits/hirokazu_C.png",hirokazu_D:"assets/characters/portraits/hirokazu_D.png",hirokazu_E:"assets/characters/portraits/hirokazu_E.png",hirokazu_F:"assets/characters/portraits/hirokazu_F.png",daichi_A:"assets/characters/portraits/daichi_A.png",naoki_A:"assets/characters/portraits/naoki_A.png",kanato_A:"assets/characters/portraits/kanato_A.png",kanato_B:"assets/characters/portraits/kanato_B.png",kanato_C:"assets/characters/portraits/kanato_C.png",koutarou_A:"assets/characters/portraits/koutarou_A.png",koutarou_B:"assets/characters/portraits/koutarou_B.png"},backgrounds:{test_1:"assets/backgrounds/background_test.png",street:"assets/backgrounds/street.png"},areas:[{name:"taketa_station",scene:null,conversationId:"taketa_station"},{name:"taketa_high_school",scene:"startPhaserGame",sceneParam:2,conversationId:null},{name:"galaxy_water",scene:null,conversationId:"ginnga_water"},{name:"udefuriojisann",scene:null,conversationId:"arm_swinging_person"},{name:"working_go_to_home_miemachi",scene:null,conversationId:"working_go_to_home_miemachi"}]},second_map:{mapKey:"second_map",tilesetKey:"second_tileset",mapTitle:"2つ目のマップ",bgm:"assets/audio/bgm/stage1/kessen_diaruga.mp3",eventBgm:{area_1:"assets/audio/bgm/events/school_event.mp3",area_2:"assets/audio/bgm/events/romantic_event.mp3"},areas:[{name:"area_1",scene:"SecondMap_Area1Scene"},{name:"area_2",scene:"SecondMap_Area2Scene"}]},third_map:{mapKey:"third_map",tilesetKey:"third_tileset",mapTitle:"3つ目のマップ",bgm:"assets/audio/bgm/stage1/kessen_diaruga.mp3",eventBgm:{area_A:"assets/audio/bgm/events/school_event.mp3",area_B:"assets/audio/bgm/events/romantic_event.mp3"},areas:[{name:"area_A",scene:"ThirdMap_AreaAScene"},{name:"area_B",scene:"ThirdMap_AreaBScene"}]},japan:{mapKey:"japan",tilesetKey:"zennkoku",mapTitle:"日本マップ",bgm:{map:"assets/audio/bgm/Theme_from_Back_To_The_Future.mp3",curono:"assets/audio/bgm/curono.mp3",togetogetarumeiroo:"assets/audio/bgm/togetogetarumeiroo.mp3"},se:{touch:"assets/audio/se/touch_7.mp3",map_touch:"assets/audio/se/touch_2.mp3"},characters:{hirokazu_A:"assets/characters/portraits/hirokazu_A.png",hirokazu_B:"assets/characters/portraits/hirokazu_B.png",hirokazu_C:"assets/characters/portraits/hirokazu_C.png",hirokazu_D:"assets/characters/portraits/hirokazu_D.png",hirokazu_E:"assets/characters/portraits/hirokazu_E.png",hirokazu_F:"assets/characters/portraits/hirokazu_F.png",daichi_A:"assets/characters/portraits/daichi_A.png",naoki_A:"assets/characters/portraits/naoki_A.png"},backgrounds:{test_1:"assets/backgrounds/background_test.png"},areas:[{name:"computer",scene:null,conversationId:"computer"},{name:"breaking_car",scene:null,conversationId:"breaking_car"},{name:"special_scam",scene:null,conversationId:"special_scam"},{name:"rojyounopenki",scene:null,conversationId:"rojyounopenki"},{name:"tereapo",scene:null,conversationId:"tereapo"},{name:"gray_bytes",scene:null,conversationId:"gray_bytes"}]}};class P extends Phaser.Scene{constructor(e){super({key:e.sceneKey}),this.mapConfig=e.mapConfig,this.mapId=e.mapId,this.mapManager=null,this.areaSelectionManager=null,this.uiManager=null,this.cameraManager=null,this.audioManager=null,this.visualFeedbackManager=null,this.isMobile=!1,this.scaleToggleButton=null,this.scaleToggleButtonGraphics=null}preload(){const e="taketastage"===this.mapId?"taketa":this.mapId,t="taketastage"===this.mapId?"taketa":this.mapConfig.mapKey,a="japan"===this.mapId?"zennkoku":this.mapConfig.tilesetKey;this.load.tilemapTiledJSON(this.mapConfig.mapKey,`assets/maps/${e}/${t}.tmj`),this.load.image(this.mapConfig.tilesetKey,`assets/maps/${e}/${a}.png`),this.load.on("fileerror",(e=>{console.error(`File not found: ${e.key}, path: ${e.url}`)})),this.loadBgmFiles(),this.loadSeFiles(),this.loadCharacterFiles(),this.loadBackgroundFiles(),this.load.on("fileerror",(e=>{console.warn(`File not found: ${e.key}, using fallback`),this.mapManager?.createFallbackImage(e.key)})),this.load.on("complete",(()=>{}))}loadSeFiles(){this.mapConfig.se&&Object.keys(this.mapConfig.se).forEach((e=>{this.load.audio(`se_${e}`,this.mapConfig.se[e])}))}loadBgmFiles(){this.mapConfig.bgm&&"object"==typeof this.mapConfig.bgm&&Object.keys(this.mapConfig.bgm).forEach((e=>{this.load.audio(`bgm_${e}`,this.mapConfig.bgm[e])})),this.mapConfig.eventBgm&&Object.keys(this.mapConfig.eventBgm).forEach((e=>{this.load.audio(`bgm_event_${e}`,this.mapConfig.eventBgm[e])}))}loadCharacterFiles(){this.mapConfig.characters&&Object.keys(this.mapConfig.characters).forEach((e=>{this.load.image(e,this.mapConfig.characters[e])}))}loadBackgroundFiles(){this.mapConfig.backgrounds&&Object.keys(this.mapConfig.backgrounds).forEach((e=>{this.load.image(e,this.mapConfig.backgrounds[e])}))}create(){try{this.isMobile=this.sys.game.device.input.touch,this.cameraManager=new p(this),this.cameraManager.setBackgroundColor("#87CEEB"),this.mapManager=new i(this),this.mapManager.createMap(this.mapConfig.mapKey,this.mapConfig.tilesetKey),this.mapManager.scaleMapToScreen(),this.cameraManager.setupCamera(this.mapManager.getMapSize()),this.areaSelectionManager=new B(this),this.visualFeedbackManager=new o(this),"taketa_city"!==this.mapConfig.mapKey&&"bunngo_mie_city"!==this.mapConfig.mapKey&&"japan"!==this.mapConfig.mapKey||(this.conversationTrigger=new y(this),this.scene.add("ConversationScene",A));const e=this.mapManager.getAreas(),t=this.mapConfig.areas,a=e.map((e=>{const a=t.find((t=>t.name===e.name));return{...e,scene:a?.scene||null,sceneParam:a?.sceneParam||null,conversationId:a?.conversationId||null}}));this.areaSelectionManager.setupAreas(a),this.uiManager=new h,this.uiManager.createMapUI(this,this.mapConfig.mapTitle),this.time.delayedCall(100,(()=>{try{this.uiManager.createBackButton(this),console.log("[MapSelectionStage] 戻るボタンを作成しました")}catch(e){console.error("[MapSelectionStage] 戻るボタンの作成に失敗:",e)}})),this.setupTouchEvents(),this.createScaleToggleButton(),this.time.delayedCall(200,(()=>{try{this.audioManager=new b(this),this.audioManager.playBgm("bgm_map",.3)}catch(e){}})),this.scale.on("resize",this.handleResize,this),this.events.on("shutdown",this.shutdown,this)}catch(e){console.error(`Error creating ${this.mapConfig.mapTitle}:`,e),console.error("Stack trace:",e.stack)}}setupTouchEvents(){this.input.on("pointerdown",(e=>{this.handleTouch(e)})),this.cameraManager.setupScrollControls(),this.cameraManager.setupPinchZoom()}handleTouch(e){try{if(!this.cameras||!this.cameras.main)return void console.error(`${this.mapConfig.mapTitle}: Camera not available`);const t=this.cameras.main.getWorldPoint(e.x,e.y),a=t.x,s=t.y;this.areaSelectionManager&&this.areaSelectionManager.handleTouchAt(a,s),this.visualFeedbackManager&&this.visualFeedbackManager.showTouchRipple(a,s)}catch(e){console.error(`${this.mapConfig.mapTitle}: Error in handleTouch:`,e)}}createScaleToggleButton(){this.scaleToggleButton&&(this.scaleToggleButton.destroy(),this.scaleToggleButton=null),this.scaleToggleButtonGraphics&&(this.scaleToggleButtonGraphics.destroy(),this.scaleToggleButtonGraphics=null);const e=this.add.graphics();this.scaleToggleButtonGraphics=e;const t=(t,a=!1)=>{e.clear();const s=43+(t.length>2?15*(t.length-2)+5:0),r=a?.4:.3,i=a?3815994:2763306,n=a?.98:.95,o=a?.15:.1;e.fillStyle(0,r),e.fillRoundedRect(4.5,40,s,30,8),e.fillStyle(i,n),e.fillRoundedRect(2.5,38,s,30,8),e.fillStyle(16777215,o),e.fillRoundedRect(2.5,38,s,15,8)};t("拡大"),e.setScrollFactor(0),e.setDepth(1e3);const a=this.add.text(7.5,43,"拡大",{fontSize:"16px",fill:"#ffffff",fontWeight:"bold",fontFamily:"Arial"});this.scaleToggleButton=a,a.setScrollFactor(0),a.setDepth(1002),a.setInteractive(),a.on("pointerdown",(()=>{this.cameraManager.toggleMapScale(),1.5===(this.cameraManager.scene.mapManager?.mapScaleX||this.cameraManager.currentScale)?(a.setText("全体マップ表示"),t("全体マップ表示")):(a.setText("拡大"),t("拡大"))})),a.on("pointerover",(()=>{const e=a.text;t(e,!0)})),a.on("pointerout",(()=>{const e=a.text;t(e,!1)})),a.setText("拡大")}handleResize(e){try{if(this.mapManager?.handleResize(e),this.cameraManager?.setupCamera(this.mapManager.getMapSize()),this.areaSelectionManager){this.areaSelectionManager.destroy(),this.areaSelectionManager=new B(this);const e=this.mapManager.getAreas(),t=this.mapConfig.areas,a=e.map((e=>{const a=t.find((t=>t.name===e.name));return{...e,scene:a?.scene||null}}));this.areaSelectionManager.setupAreas(a)}this.uiManager?.updateMapUI(e),this.createScaleToggleButton()}catch(e){console.error("Error handling resize:",e)}}update(){this.areaSelectionManager?.update(),this.cameraManager?.update()}destroy(){this.shutdown(),super.destroy()}shutdown(){this.audioManager&&(this.audioManager.stopAll(),this.audioManager.destroy(),this.audioManager=null),this.mapManager&&(this.mapManager.destroy(),this.mapManager=null),this.areaSelectionManager&&(this.areaSelectionManager.destroy(),this.areaSelectionManager=null),this.uiManager&&(this.uiManager.destroy(),this.uiManager=null),this.cameraManager&&(this.cameraManager.destroy(),this.cameraManager=null),this.visualFeedbackManager&&(this.visualFeedbackManager.destroy(),this.visualFeedbackManager=null),this.conversationTrigger&&(this.conversationTrigger.destroy(),this.conversationTrigger=null),this.scaleToggleButton&&(this.scaleToggleButton.destroy(),this.scaleToggleButton=null),this.scaleToggleButtonGraphics&&(this.scaleToggleButtonGraphics.destroy(),this.scaleToggleButtonGraphics=null),this.sound&&this.sound.stopAll()}}function D(e,t){const a=T[e];return a?new P({sceneKey:t,mapConfig:a,mapId:e}):(console.error(`Map config not found for: ${e}`),null)}let I=null;function E(e){const t=function(){if(window.game)return window.game;const e={...r,scene:[]};return I=new Phaser.Game(e),window.game=I,window.gameInstance=I,I}();let a,s;switch(e){case 1:default:a=C,s="Stage1Scene";break;case 2:a=v,s="Stage2Scene";break;case 3:a=M,s="Stage3Scene";break;case"miemachi":case"bunngo_mie_city":a=D("miemachi","MiemachiStage"),s="MiemachiStage";break;case"taketa":case"taketa_city":a=D("taketastage","TaketastageStage"),s="TaketastageStage";break;case"japan":a=D("japan","JapanStage"),s="JapanStage"}t.scene.add(s,a,!0)}window.startPhaserGame=E}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(355),window.addEventListener("orientationchange",(()=>{setTimeout((()=>{window.gameInstance&&window.gameInstance.scale&&window.gameInstance.scale.resize(window.innerWidth,window.innerHeight)}),500)}))})();