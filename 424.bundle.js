"use strict";(self.webpackChunkzosusoft_prj_hirokazu=self.webpackChunkzosusoft_prj_hirokazu||[]).push([[424],{424:(e,t,i)=>{i.r(t),i.d(t,{DialogSystem:()=>s});class s{constructor(e,t){e&&e.scene?(this.scene=e,this.isActive=!1,this.dialogContainer=null,this.dialogText=null,this.currentDialog=null,this.currentTextIndex=0,this.dialogs=t,this.setupUI(),this.setupInput()):console.error("DialogSystem: Invalid scene provided")}hasDialog(e){return this.dialogs&&void 0!==this.dialogs[e]}setupUI(){if(!this.scene||!this.scene.cameras||!this.scene.cameras.main)return void console.warn("DialogSystem: Scene or camera is not available");this.dialogContainer&&this.dialogContainer.destroy();const e=this.scene.cameras.main,t=e.width||800,i=e.height||600,s=i-120-20-20;this.dialogContainer=this.scene.add.container(0,0),this.dialogContainer.setDepth(1e4),this.dialogContainer.setVisible(!1);const o=this.scene.add.rectangle(t/2,s+60,t-20,120,0,.8);this.nameBox=this.scene.add.text(30,s+15,"TEST_NAME",{fontSize:"16px",fill:"#ffff00",backgroundColor:"#000000",padding:{x:10,y:5}}),this.nameBox.setOrigin(0,0),console.log("[DialogSystem] 名前ボックス作成完了:",this.nameBox),this.dialogContainer.add(this.nameBox),console.log("[DialogSystem] 名前ボックスをコンテナに追加完了"),console.log("[DialogSystem] 名前ボックスの位置:",this.nameBox.x,this.nameBox.y),console.log("[DialogSystem] 名前ボックスの可視性:",this.nameBox.visible),console.log("[DialogSystem] コンテナの可視性:",this.dialogContainer.visible),this.dialogText=this.scene.add.text(30,s+45,"",{fontSize:"18px",fill:"#ffffff",metrics:{ascent:15,descent:5,fontSize:18},wordWrap:{width:t-60}}),this.dialogText.setOrigin(0,0),this.dialogContainer.add(this.dialogText),this.continueIndicator=this.scene.add.text(t-20,s+60-20,"タップで続行",{fontSize:"12px",fill:"#ffff00",align:"center"}),this.continueIndicator.setOrigin(1,1),this.scene.tweens.add({targets:this.continueIndicator,alpha:.3,duration:800,yoyo:!0,repeat:-1}),this.dialogContainer.add([o,this.dialogText,this.continueIndicator]),o.removeAllListeners(),o.setInteractive({hitArea:new Phaser.Geom.Rectangle(-t/2,-80,t,160),hitAreaCallback:Phaser.Geom.Rectangle.Contains,useHandCursor:!1}),o.on("pointerdown",((e,t,i,s)=>{s&&s.stopPropagation&&s.stopPropagation(),this.isActive&&this.nextDialog()})),this.dialogContainer.setInteractive({hitArea:new Phaser.Geom.Rectangle(0,0,t,i),hitAreaCallback:Phaser.Geom.Rectangle.Contains}),this.dialogContainer.on("pointerdown",((e,t,i,s)=>{s&&s.stopPropagation&&s.stopPropagation(),this.isActive&&this.nextDialog()})),this.dialogContainer.setScrollFactor(0),this.scene.scale.off("resize",this.handleResize,this),this.scene.scale.on("resize",this.handleResize,this)}handleResize(e){this.scene&&this.scene.cameras&&this.scene.cameras.main&&this.dialogContainer?this.setupUI():console.warn("DialogSystem: Scene, camera, or dialog container is not available for resize")}setupInput(){this.scene&&this.scene.input&&this.scene.input.keyboard?this.scene.input.keyboard.on("keydown-SPACE",(()=>{this.isActive&&this.nextDialog()})):console.warn("DialogSystem: Scene input is not available")}showDialog(e){this.startDialog(e)}startDialog(e){this.dialogs[e]?(this.currentDialog=this.dialogs[e],this.currentTextIndex=0,this.isActive=!0,this.currentTextIndex=0,this.dialogContainer.setVisible(!0),this.showMessage()):console.error("No dialog found for:",e)}showMessage(){if(!this.currentDialog||!this.currentDialog.messages)return;if(this.currentTextIndex>=this.currentDialog.messages.length)return void this.endDialog();const e=this.currentDialog.messages[this.currentTextIndex],t="string"==typeof e?e:e.text,i="string"==typeof e?this.currentDialog.name:e.speaker;console.log("[DialogSystem] showMessage",{index:this.currentTextIndex,name:this.currentDialog.name,speaker:i,text:t}),this.nameBox?(console.log("[DialogSystem] 名前ボックス更新:",i),console.log("[DialogSystem] 名前ボックスの現在のテキスト:",this.nameBox.text),console.log("[DialogSystem] 名前ボックスの位置:",this.nameBox.x,this.nameBox.y),console.log("[DialogSystem] 名前ボックスの可視性:",this.nameBox.visible),this.nameBox.setText(i),console.log("[DialogSystem] 名前ボックス更新後:",this.nameBox.text)):console.warn("[DialogSystem] 名前ボックスが存在しません"),this.dialogText.setText(t)}nextDialog(){this.currentTextIndex++,this.showMessage()}endDialog(){this.isActive=!1,this.dialogContainer&&this.dialogContainer.setVisible(!1),this.scene&&this.scene.scale&&this.scene.scale.off("resize",this.handleResize,this)}isDialogActive(){return this.isActive}destroy(){this.endDialog(),this.dialogContainer&&(this.dialogContainer.destroy(),this.dialogContainer=null),this.nameBox&&(this.nameBox.destroy(),this.nameBox=null),this.dialogText&&(this.dialogText.destroy(),this.dialogText=null),this.scene&&this.scene.scale&&this.scene.scale.off("resize",this.handleResize,this),this.scene&&this.scene.input&&this.scene.input.keyboard&&this.scene.input.keyboard.off("keydown-SPACE"),this.currentDialog=null,this.currentTextIndex=0,this.dialogs=null,this.scene=null}}}}]);